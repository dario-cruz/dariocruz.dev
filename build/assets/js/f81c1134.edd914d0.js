"use strict";(self.webpackChunkdariocruz_dev=self.webpackChunkdariocruz_dev||[]).push([[8130],{77735:e=>{e.exports=JSON.parse('{"archive":{"blogPosts":[{"id":"LearningLinuxArch","metadata":{"permalink":"/blog/LearningLinuxArch","source":"@site/blog/2025-12-11-LearningLinuxArch/index.md","title":"Learning Linux with Arch","description":"Notes from learning Linux by installing and using Arch.","date":"2025-12-11T00:00:00.000Z","tags":[{"inline":true,"label":"Linux","permalink":"/blog/tags/linux"},{"inline":true,"label":"Arch","permalink":"/blog/tags/arch"},{"inline":true,"label":"Grub","permalink":"/blog/tags/grub"},{"inline":true,"label":"fdisk","permalink":"/blog/tags/fdisk"},{"inline":true,"label":"terminal","permalink":"/blog/tags/terminal"}],"readingTime":13.46,"hasTruncateMarker":true,"authors":[{"name":"Dario Cruz","title":"Maintainer of DarioCruz.dev","url":"https://github.com/dario-cruz","imageURL":"https://github.com/dario-cruz.png","key":"dcruz","page":null}],"frontMatter":{"slug":"LearningLinuxArch","title":"Learning Linux with Arch","description":"Notes from learning Linux by installing and using Arch.","keywords":["Linux","Arch Linux","terminal","fdisk","GRUB"],"image":"/img/itsmedario.webp","authors":["dcruz"],"tags":["Linux","Arch","Grub","fdisk","terminal"],"enableComments":true,"toc_min_heading_level":2,"toc_max_heading_level":6},"unlisted":false,"nextItem":{"title":"Unit42 (HTB-Sherlock)","permalink":"/blog/Unit42-Sherlock"}},"content":"![Learning Linux with Arch - Title Image](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1764616730620.webp)\\n\\nHello all,\\n\\nI know that there has been some time between my previous post and this one. In recent months I have taken on a new role and have been ensuring that I have been taking on my role\'s responsibilities and tasks. This hasn\'t left much in the way of time for learning and exploring but, now that everything has settled down, I can dig into some new topics.\\n\\n\x3c!-- truncate --\x3e\\n\\n## Why Linux & Why Arch\\n\\nLinux is the OS of choice for all tech infrastructure. You would be hard pressed to find any organization that does not use Linux in some way to offer websites and/or services. Linux is king when it comes to the back-end of most of the internet as well.\\n\\n### Arch Linux\\n\\nArch Linux has been around since 2002 and has made a reputation for being a barebones, set it up yourself, no bloat version of Linux.  Users of Arch are required to actively learn and manage the setup of the OS.\\n\\nThe inspiration for this project and practical learning Linux has come from a youtuber that I have watched in passing named Mischa Van Den Burg. See the video below for yourself.\\n\\n<iframe class=\\"vcenter\\" width=\\"560\\" height=\\"315\\" src=\\"https://www.youtube.com/embed/qboMuv9vSpQ?si=L_9d_QIf37gAGsI0\\" title=\\"YouTube video player\\" frameborder=\\"0\\" allow=\\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\\" referrerpolicy=\\"strict-origin-when-cross-origin\\" allowfullscreen></iframe>\\n\\n## Installation\\n\\nGetting started with Arch is fairly simple, we grab the ISO image from the Arch website, either using BitTorrent to download or using one of the provided mirrors for your region. For my purposes I will be installing Arch in a VirtualBox VM.\\n\\nI will also be following/using the official Arch documentation, which can be found [here](https://wiki.archlinux.org/title/Installation_guide) if you would like to follow along.\\n\\nI provisioned the VM with 2 CPU cores, 4gb of RAM, and 70gb of storage space, which should be enough for doing a complete install. I booted the virtual machine to the iso image and we are present with a terminal with root access.\\n\\n![Install 01](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1764704954243.webp)\\n\\n### Setting up the Filesystem\\n\\nBefore we actually install Arch, we need to prep the storage device, setting up partitions and the filesystem.\\n\\nThe first steps in doing this are to verify the boot mode which can be UEFI or plain old BIOS.\\n\\n![Filesystem 01](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1764706094210.webp)\\n\\nAs you can see I ran the command `cat /sys/firmare/efi/fw_platform_size` and as you can see from the output of the terminal in the image above, this returned no results. According to the Arch wiki if no file or directory is found from catting this directory, then most likely  we are running in BIOS mode.\\n\\nNext I tested network connectivity, doing an `ip link` to ensure that my virtual ethernet link was up, `ifconfig` to check and see if we successfully obtained network configuration via DHCP, and also completed a `ping ping.archlinux.org` to verify that we can access/traverse the outside internet.\\n\\n![Filesystem 02](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1764707766286.webp)\\n\\nHaving our network connectivity confirmed, let\'s update the time so that we have no networking issues related to time sync to do this I ran the command, `timedatectl`.\\n\\n![Filesystem 03](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1764708058434.webp)\\n\\n#### Partitioning\\n\\nLets take a look at the disks that we have to work with. In Linux we do this via the fdisk utility, with the complete command being `fdisk -l` The `-l` at the end being the flag that designates for the tool to list out all of the drives that are found on the host system.\\n\\n![Partitioning 01](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1765471929995.webp)\\n\\nWe can see from the output that our main QEMU disk is present and is reporting the correct size, being 70gb.\\n\\nOur VM will be using the MBR and the regular BIOS for booting so the partitions on the VM will be simpler than if we were to use UEFI, which needs its own dedicated `/boot` partition.\\n\\nFor our use case we will be creating the following:\\n- 1x SWAP Partition, Size 10gb.\\n- 1x Root Partition, Size 60gb.\\n\\nIn order to actually make these partitions we will again use the tool `fdisk`. If we look at the image from the previous step, we can see that our VM drive, the QEMU one, has the disk name of `/dev/sda`. We will use this with fdisk to target and partition the correct drive.\\n\\nFull command to run == `fdisk /dev/sda`\\n\\nWhen we run the command we are brought to an interactive prompt.\\n\\n![Partitioning 02](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1764709686579.webp)\\n\\nSince no commands we can use are displayed I hit `m` to show the list of available commands/options.\\n\\n![Partitioning 03](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1764709757897.webp)\\n\\nInitially when we ran the fdisk command targeting our VM drive, we received a message stating that no partition table had been created. I went ahead and ran the option for creation of the partition table for our drive, which is `o` in fdisk.\\n\\n![Partitioning 04](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1764709877221.webp)\\n\\nAnd now  lets create the root partition.  Using the fdisk option `n`, we can create a new partition\\n\\n![Partitioning 05](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1765472548162.webp)\\n\\nSelecting P for the primary I created the primary partition for Arch to be installed. I gave the primary partition 60gb of storage.  \\n\\nThen I created second primary partition, this one being 10gb in size.\\n\\n![Partitioning 06](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1764710241448.webp)\\n\\nSince I created both partitions as Linux partitions, I went back and converted the second 3gb partition to `Linux Swap`. Effectively setting up a swap partition for Arch to use.\\n\\n![Partitioning 07](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1764710295076.webp)\\n\\n![Partitioning 08](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1765472645151.webp)\\n\\nAnd above we have both of our partitions ready to go. Note that we do not need any partition for MBR, if we were making use of  GPT or UEFI, we would need to setup a dedicated partition for these boot mechanisms.\\n\\n![Partitioning 09](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1764856586941.webp)\\n\\nThe now, before we exit the fdisk utility, we need to apply the changes that we just made. I displayed the help menu again to get the command to \\"write\\" the changes to the disk.\\n\\n![Partitioning 10](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1764856619353.webp)\\n\\n#### Formatting\\n\\nNow, with our partition table and partitions set, we need to format them in preparation for the OS installation.\\n\\n`/dev/sda1` is our root file system for Arch, thus it will need to be formatted as ext4.\\n`/dev/sda2` is our swap partition and will need to be formatted as swap.\\n\\nBelow are the commands that I ran to format each of the partitions.\\n\\n```\\nmkfs.ext4 /dev/sda1\\nmkswap /dev/sda2\\n```\\n\\n![Formatting 01](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1765472783589.webp)\\n\\n#### Mounting\\n\\nHere we are mounting the now partitioned and formatted file systems. This will make them available to the temporary Arch OS for installation of the permanent Arch OS.\\n\\nI will also enable our swap filesystem via the command below.\\n\\n![Mounting 01](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1765211736725.webp)\\n\\nWith that, we now have our file system created and ready for the OS install.\\n\\n### Mirrors & Packages\\n\\nI adjusted the mirrors in `/etc/pacman.d/mirrorlists` moving all of the *United States* based mirrors to the top of the list as that is where I am currently located. Since these are geographically closer to me, we should receive good throughput network wise as there is less network traversal taking place.\\n\\n![Pacakges 01](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1765214524353.webp)\\n\\n#### Microcode\\n\\nWith our mirrors for the package repositories pointing to what is locally available. we can proceed with installation of microcode updates. *Microcode* is an intermediary layer between the CPU and the instruction set of the computer, more can be learned about it [here](https://en.wikipedia.org/wiki/Microcode).\\n\\nSince we are running this installation of Arch Linux in a VM,  which is emulating an x86/x64 based CPU, I will opt for installing the intel-based microcode.\\n\\nBelow is the complete command so far, more packages will be added to the command before executing:\\n\\n```\\npacstrap -K /mnt base linux linux-firmware intel-ucode \\n```\\n\\n#### Userspace Utils\\n\\nAccording to the Arch wiki we should install some filesystem tools. These will aid in file system creation and management of raid and lvm after install. I have selected a few that I think will be needed and updated the package install command.\\n\\n```\\npacstrap -K /mnt exfat-utils e2fsprogs hfsprogs ntfs-3g xfsprogs zfs-utils lvm2 mdadm\\n```\\n\\n#### Network Utils\\n\\nOn our new system we will need networking capabilities(obviously), so I added the `networkmanager` package to the full pacstrap command along with the addition of `mn-connection-editor` & `network-manager-applet`. Both of which provide graphical elements for network configuration/monitoring.\\n\\n```\\npacstrap -K /mnt networkmanager mn-connection-editor network-manager-applet\\n```\\n\\n#### Console Text Editors\\n\\nLinux is primarily based on text, every setting, configuration, as well as other elements, are based in text so it is essential that we have some basic way to edit forms of text from the command line. I have included `nano` & `vim`.\\n\\n```\\npacstrap -K /mnt nano vim\\n```\\n\\n#### Documentation Packages\\n\\nAnyone that has had extended time in the Linux command-line will know that `man` pages are key for troubleshooting and general up keep of your system. They make learning & understanding of CLI tools simple. For this install I will be adding `man` & `info` to the list of packages to be bootstrapped before OS installation.\\n\\n```\\npacstrap -K /mnt man-db man-pages texinfo\\n```\\n\\n#### Running `pacstrap`\\n\\nRunning the complete command you can observe that most of the packages strapped correctly but, some errored out with *\\"error target not found\\"*.\\n\\n- For the linux-firmware package I had made a typo in the package name.\\n- hfsprogs is not available on the arch image according to the matrix found on this [page](https://wiki.archlinux.org/title/File_systems).\\n- zfs-utils is not available on the arch image and can be installed after OS install.\\n- texinfo failed to install due to typo in the package name, which has been fixed.\\n\\n![pacstrap output-result](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1765218254912.webp)\\n\\nAnd with that, we have all of the needed packages for our Arch Linux installation.\\n\\n### System Configuration\\n\\nNext we will start to configure the system environment. There are a few items on the list that need to be addressed and the first of which is *Fstab*\\n\\n#### Fstab\\n\\nFstab is a service that acts as the file system table, it is used for automatically mounting file systems. We will make use of `genfstab` to generate an fstab file using the below command.\\n\\n```\\ngenfstab -U /mnt >> /mnt/etc/fstab\\n```\\n\\n![Fstab 01](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1765474173736.webp)\\n\\n#### Changing Root for Further Config\\n\\nIn order to complete the rest of the configuration process for the Arch install, we need to change over to the `root` account on the permanent file system and make some adjustments. In order to accomplish this we run the command below:\\n\\n```\\narch-chroot /mnt\\n```\\n\\n![arch-chroot 01](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1765226057969.webp)\\n\\n##### Adjusting Local Time\\n\\nBelow are the commands used to adjust local time. I changed my time zone over to **EST**.\\n\\n```\\nln -sF /usr/share/zoneinfo/EST /etc/localtime\\nhwclock --systohc\\n```\\n\\nWe are effectively using the Linux \\"softlink\\"/symbolic link function to reference the EST zone info from `/etc/localtime`.  Then with `hwclock --systohc` we are syncing the hardware clock of our VM to the system/software clock, adjusting the hardware clock to match the software/system clock we just adjusted to EST time.\\n\\n##### Localization\\n\\nMoving on, lets now setup our keyboard layout and localization for dates, currency, etc. In order to do this I will be running the command `localectl set-locale LANG=en_US.UTF-8`. Then I ran the command `locale` to list out all of the localization settings that have been applied.  \\n\\n```\\nlocaledef --list-archive\\nlocalectl set-locale LANG=en_US.UTF-8\\n```\\n\\n![Localization 01](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1765233779173.webp)\\n\\n##### Network Hostname\\n\\nTime to define the hostname for our Arch install. To accomplish this we need to create a file in `/etc/hostname` and add our designated hostname there, inside of that file. I had to find a work around to accomplish this as nano is not installed on our Arch system yet. I made use of the redirects to echo the hostname into the file after creation.\\n\\n![Hostname 01](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1765234124206.webp)\\n\\n##### Install & Config GRUB\\n\\nThis step is very important. GRUB handles the booting of our Arch install, if we do not install and configure it, we will not be able to boot to the OS after completion of install. To do this I used `pacman` to install the grub bootloader.\\n\\n```\\npacman -S grub\\n```\\n\\n![Grub 01](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1765475170947.webp)\\n\\nI then proceeded to apply the grub install to our install drive. *Note that I said drive and not partition, grub needs to be installed on the entire drive and not just the partition that we will be using as our main for the OS.*\\n\\n```\\ngrub-install /dev/sda\\n```\\n\\n![Grub 02](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1765475414454.webp)\\n\\nWith grub applied to the drive, we need to generate a configuration file, grub has a built in command for this which is `grub-mkconfig`. We will point this tool to the file path `/boot/grub/grub.cfg` using the `-o` flag, without this flag the config would just be output to the terminal.\\n\\n```\\ngrub-mkconfig -o /boot/grub/grub.cfg\\n```\\n\\n![Grub 03](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1765475702344.webp)\\n\\n##### Network Manager\\n\\nI will be installing the `networkmanager` tool as well. This is a suite of tools that aid in network connectivity on Linux, Arch included.  Using `pacman` to install and then using `systemctl` to enable the service on our Arch install.\\n\\n![Network Manager 01](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1765476114063.webp)\\n\\n##### Setting Root Password\\n\\nAnd now for the final part before rebooting and completing our base installation, which will be setting the root password for our Arch OS.\\n\\n![Root setup 01](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1765234584311.webp)\\n\\nSuper simple, just run the `passwd` tool and then enter & confirm the new password and it is applied to the root account, of which we are currently logged into.\\n\\n##### Time to Reboot\\n\\n![final countdown gif](https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExZnFyNWE3MjJocjBhaW1iM3k2M2kyemxhczNpZ3R3amc4Y2VyOWxyeiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/izJTd56RgeU4U/giphy.gif)\\n\\nAnd with that we are finished with the base installation of Arch Linux, though we still do not have a GUI/desktop environment installed, we have a basic Linux OS as a base on which to build. In order to confirm our changes and boot into the OS we just setup/configured the only last step is to reboot.\\n\\nI will be following the Arch wiki\'s recommendation to unmount all of the partitions.\\n\\n![Umount & Shutdown](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1765234954390.webp)\\n\\nAnd finally here we are after reboot, successfully booted into Arch Linux.\\n\\n![Successful Boot!](img/Linux%20Deep%20Dive%20-%20Learning%20Linux%20via%20Arch-1765476404848.webp)\\n\\nFrom here we can continue to build out the system, adding  various tools and functionality as well as a graphical interface. Keep tabs on the blog for the next post in the series."},{"id":"Unit42-Sherlock","metadata":{"permalink":"/blog/Unit42-Sherlock","source":"@site/blog/2025-06-09-Unit42/index.md","title":"Unit42 (HTB-Sherlock)","description":"HTB Sherlock Unit42 investigation focused on Sysmon logs and threat detection.","date":"2025-06-09T00:00:00.000Z","tags":[{"inline":true,"label":"hackthebox","permalink":"/blog/tags/hackthebox"},{"inline":true,"label":"Sherlocks","permalink":"/blog/tags/sherlocks"},{"inline":true,"label":"Threat Detection","permalink":"/blog/tags/threat-detection"},{"inline":true,"label":"Sysmon","permalink":"/blog/tags/sysmon"},{"inline":true,"label":"EvtxECmd","permalink":"/blog/tags/evtx-e-cmd"},{"inline":true,"label":"TimelineExplorer","permalink":"/blog/tags/timeline-explorer"},{"inline":true,"label":"LogAnalysis","permalink":"/blog/tags/log-analysis"},{"inline":true,"label":"EricZimmermanTools","permalink":"/blog/tags/eric-zimmerman-tools"}],"readingTime":11.17,"hasTruncateMarker":true,"authors":[{"name":"Dario Cruz","title":"Maintainer of DarioCruz.dev","url":"https://github.com/dario-cruz","imageURL":"https://github.com/dario-cruz.png","key":"dcruz","page":null}],"frontMatter":{"slug":"Unit42-Sherlock","title":"Unit42 (HTB-Sherlock)","description":"HTB Sherlock Unit42 investigation focused on Sysmon logs and threat detection.","keywords":["Hack The Box","Sherlock","Unit42","Sysmon","threat detection"],"image":"/img/itsmedario.webp","authors":["dcruz"],"tags":["hackthebox","Sherlocks","Threat Detection","Sysmon","EvtxECmd","TimelineExplorer","LogAnalysis","EricZimmermanTools"],"enableComments":true},"unlisted":false,"prevItem":{"title":"Learning Linux with Arch","permalink":"/blog/LearningLinuxArch"},"nextItem":{"title":"CrownJewel 2 (HTB-Sherlock)","permalink":"/blog/CrownJewel2-Sherlock"}},"content":"![Title Image - Unit42](img/Unit%2042%20_HTB-Sherlock_-1749482256043.webp)\\n\\nWelcome back everyone. The following Sherlock is being completed in preparation for taking the HTB CDSA exam. I came across a medium blog post by the user, [Hammazahmed](https://medium.com/@hammazahmed40/mastering-cdsa-by-htb-f11e99403986). He provides some advice for learning and practicing skills before taking the exam. Specifically, he mentioned this Sherlock investigation, along with some others, [BFT](https://app.hackthebox.com/sherlocks/BFT), [Noted](https://app.hackthebox.com/sherlocks/Noted), RogueOne (Which I have completed, full writeup [here](https://www.dariocruz.dev/blog/RogueOne-HTB-Sherlocks)), and [Meerkat](https://app.hackthebox.com/sherlocks/BFT).\\n\x3c!-- truncate --\x3e\\n\\n## Scenario\\n\\n*In this Sherlock, you will familiarize yourself with Sysmon logs and various useful EventIDs for identifying and analyzing malicious activities on a Windows system. Palo Alto\'s Unit42 recently conducted research on an UltraVNC campaign, wherein attackers utilized a backdoored version of UltraVNC to maintain access to systems. This lab is inspired by that campaign and guides participants through the initial access stage of the campaign.*\\n\\n## The Files\\n\\nInside the zip file for this investigation, we are provided with a single Windows log file, from the Sysmon Operational log provider.\\n\\n![The Files](img/Unit%2042%20_HTB-Sherlock_-1749223199579.webp)\\n\\n## Task 1\\n\\n*How many Event logs were there with Event ID 11?*\\n\\nFor this I opted to make use of PowerShell, specifically the cmdlet `Get-WinEvent`. Referencing this amazing [PDF](https://wiki.sans.blue/Tools/pdfs/Get-WinEvent.pdf) created by the SANS institute, I was able to use the `-Path` argument to point the Cmdlet to the provided `.evtx` file.  I also applied filtering and counting of events via `| Group-Object id -NoElement | sort count`. The complete command I created is below, along with an explanation of each element.\\n\\n```PowerShell\\nGet-WinEvent -Path \'C:\\\\Sherlocks\\\\Unit 42\\\\Microsoft-Windows-Sysmon-Operational.evtx\' | Group-Object id -NoElement | sort count\\n```\\n\\n- `Get-WinEvent -Path`: Tells the Get-WinEvent cmdlet to target a specific event log file.\\n- `Group-Object`: Will display objects based on a the value of a property that is given as an argument, in this case the `id` property.\\n- `-NoElement`: Tells the Group-Object command not to include the objects in the output.\\n- `sort count`: Enables sorting via a value in this case the count of events.\\n\\nAnd here is the output of the complete command.\\n\\n![Task 1 - Image 1](img/Unit%2042%20_HTB-Sherlock_-1749224947067.webp)\\n\\nAs you can see from the output we have a list of event IDs and their counts in descending order, at the bottom the event id of 11 has a count of **56** events.\\n\\n![Task 1 - Image 2](img/Unit%2042%20_HTB-Sherlock_-1749225151076.webp)\\n\\n## Task 2\\n\\n*Whenever a process is created in memory, an event with Event ID 1 is recorded with details such as command line, hashes, process path, parent process path, etc. This information is very useful for an analyst because it allows us to see all programs executed on a system, which means we can spot any malicious processes being executed. What is the malicious process that infected the victim\'s system?*\\n\\nFor this I will be parsing the provided `.evtx` file using EvtxECmd and converting it into a `.csv` file. After the parsing/conversion we will be able to view and filter the file in Timeline Explorer, providing a clearer view of the log data and more complete searching and filtering.\\n\\n![Task 2 - Image 1](img/Unit%2042%20_HTB-Sherlock_-1749226871829.webp)\\n\\nAbove I ran EvtxECMD with the needed parameters and had it generate a `.csv` file from the provided log file.\\n\\n![Task 2 - Image 2](img/Unit%2042%20_HTB-Sherlock_-1749231600250.webp)\\n\\nI then opened the file in Timeline Explorer, displaying all the events contained in the log file, presented in groups sorted by event ID.\\n\\n![Task 2 - Image 3](img/Unit%2042%20_HTB-Sherlock_-1749232799098.webp)\\n\\nLooking at all of the 6 events pertaining to Event ID 1, we can see a suspicious process creation event invoked from the directory location and file, **C:\\\\Users\\\\CyberJunkie\\\\Downloads\\\\Preventivo24.02.14.exe.exe** which turns out to be the task flag and the malicious process that infected the system.\\n\\n![Task 2 - Image 4](img/Unit%2042%20_HTB-Sherlock_-1749232910639.webp)\\n\\n## Task 3\\n\\n*Which Cloud drive was used to distribute the malware?*\\n\\nHmm, okay so we need to find either a directory or some sort of network communication to a cloud service to pin down the flag for this task. Lets take a look at all the events that are contained in the log, just so that we know what we have to work with. Below I have included details for all the Sysmon events contained in our log file and what data they contain.\\n\\n![Task 3 Image 1](img/Unit%2042%20_HTB-Sherlock_-1749235246395.webp)\\n\\n- *Sysmon Event ID 1*: We already know from the previous tasks that this event is logged on creation of a Windows processes.\\n- *Sysmon Event ID 2*: Changing of file creation time.\\n- *Sysmon Event ID 3*: Network connection made by process.\\n- *Sysmon Event ID 5*: Windows process termination.\\n- *Sysmon Event ID 7*: DLL loaded into a process.\\n- *Sysmon Event ID 10*: Process accessing another process.\\n- *Sysmon Event ID 11*: File creation/File Overwritten.\\n- *Sysmon Event ID 12*: Creation and deletion of registry events.\\n- *Sysmon Event ID 13*: Modification of registry values.\\n- *Sysmon Event ID 15*: creation of file stream and hash of file contents.\\n- *Sysmon Event ID 17*: Named Pipe created (interprocess communication).\\n- *Sysmon Event ID 22*: DNS Queries.\\n- *Sysmon Event ID 23*: File deletion and archiving.\\n- *Sysmon Event ID 26*: File deletion logged.\\n\\nNow we know what event data we have contained in the logs, the task requires us to find what cloud drive was used. Usage of the cloud at all means communication over the internet, meaning that a DNS query should have been made to the cloud service for connection and communication. Lets take a look at *Sysmon Event ID 22*.\\n\\n![Task 3 Image 2](img/Unit%2042%20_HTB-Sherlock_-1749236734814.webp)\\n\\nAbove we can see that we have 3 logs for Sysmon Event 22. All of the events were triggered by the same user account that launched the malware and all of the events took place around the same time.\\n\\n![Task 3 Image 3](img/Unit%2042%20_HTB-Sherlock_-1749237333302.webp)\\n\\nLooking at the payload data contained in the logs we have the Image/Process that initiated the DNS query and also the QueryName/Hostname value.\\n\\n![Task 3 Image 4](img/Unit%2042%20_HTB-Sherlock_-1749237910904.webp)\\n\\nI sorted the events by time and found that we had queries for `dl.dropboxusercontent.com` & `d.dropbox.com`. Directly after, we have a query from the malware process, attempting to resolve `www.example.com`. From this information, we can confirm that the cloud drive/service that was being used was **dropbox**.\\n\\n![Task 3 Image 5](img/Unit%2042%20_HTB-Sherlock_-1749238805282.webp)\\n\\n## Task 4\\n\\n*For many of the files it wrote to disk, the initial malicious file used a defense evasion technique called Time Stomping, where the file creation date is changed to make it appear older and blend in with other files. What was the timestamp changed to for the PDF file?*\\n\\nWe know that the Sysmon Event 2 logs the file creation times. We should be able to look at these logs for a PDF file that looks to be older than it really is.\\n\\n![Task 4 Image 1](img/Unit%2042%20_HTB-Sherlock_-1749477041249.webp)\\n\\nAbove I have filtered for all the Sysmon Event 2 logs, and we have a list of file creations. Looking at the file creations and their originating process, we can see that the malware created a host of files on the system. The most notable is the only PDF file that was created and logged which is found at `C:\\\\Users\\\\CyberJunkie\\\\AppData\\\\Roaming\\\\Photo and Fax Vn\\\\Photo and vn 1.1.2\\\\install\\\\F97891C\\\\TempFolder\\\\~.pdf`.\\n\\n![Task 4 Image 2](img/Unit%2042%20_HTB-Sherlock_-1749477321545.webp)\\n\\nAnd now looking at the creation time of the PDF file we can see that the creation time logged was **`2024-01-14 08:10:06`**.\\n\\n![Task 4 Image 3](img/Unit%2042%20_HTB-Sherlock_-1749477402403.webp)\\n\\n## Task 5\\n\\n*The malicious file dropped a few files on disk. Where was \\"once.cmd\\" created on disk? Please answer with the full path along with the filename.*\\n\\nIn the previous task, we filtered for Sysmon Event 2 logs and we noticed that the malware created a few files on the affected host system. One of which was the PDF file we observed the creation time of, another was this file, `once.md`.\\n\\n![Task 5 Image 1](img/Unit%2042%20_HTB-Sherlock_-1749477656697.webp)\\n\\nLooking again at the filtered logs we have an entry for the file creation of `once.md` and we can see the full path in which the file was created. The complete file path is **`C:\\\\Users\\\\CyberJunkie\\\\AppData\\\\Roaming\\\\Photo and Fax Vn\\\\Photo and vn 1.1.2\\\\install\\\\F97891C\\\\WindowsVolume\\\\Games\\\\once.cmd`**.\\n\\n![Task 5 Image 2](img/Unit%2042%20_HTB-Sherlock_-1749477784992.webp)\\n\\n## Task 6\\n\\n*The malicious file attempted to reach a dummy domain, most likely to check the internet connection status. What domain name did it try to connect to?*\\n\\nThis one is simple, in Task 3, we were asked, what cloud service was used to distribute the malware. We observed a timeline of Sysmon Event 22 logs, in which the affected computer attempted to reach two Dropbox domains and also the domain **`www.example.com`**, of which I annotated in the image that it was potentially an attempt for the malware to check for internet connection before downloading more malicious files. I have included the image below.\\n\\n![Task 6 Image 1](img/Unit%2042%20_HTB-Sherlock_-1749237910904.webp)\\n\\n![Task 6 Image 2](img/Unit%2042%20_HTB-Sherlock_-1749478083738.webp)\\n\\n## Task 7\\n\\n*Which IP address did the malicious process try to reach out to?*\\n\\nReferencing the Sysmon Event ID, present in the provided log file, we should be able to make use of Sysmon Event 3, which logs data pertaining to a process making a network connection.\\n\\n![Task 7 Image 1](img/Unit%2042%20_HTB-Sherlock_-1749478469969.webp)\\n\\nFiltering for Sysmon Event 3 there is only a single log entry, and it is related to the malicious file that was run and infected the host system.\\n\\n![Task 7 Image 2](img/Unit%2042%20_HTB-Sherlock_-1749478792372.webp)\\n\\nScrolling to the payload data and executable info we confirm that the log was for the malicious file, and we also see that the destination IP address the malware was attempting to connect to was, **`93.184.216.34`**.\\n\\n![Task 7 Image 3](img/Unit%2042%20_HTB-Sherlock_-1749478910040.webp)\\n\\n## Task 8\\n\\n*The malicious process terminated itself after infecting the PC with a backdoored variant of UltraVNC. When did the process terminate itself?*\\n\\nSysmon Event 5 correlates to the termination of processes. It is safe to assume that if we have any logs for this type of event, that there would be some useful information pertaining to the termination of the malware that infected the host.\\n\\n![Task 8 Image 1](img/Unit%2042%20_HTB-Sherlock_-1749481917261.webp)\\n\\nFiltering for Sysmon Event 5 we have a single log entry, of which the executable info for the log entry points to the malicious file from the previous tasks.\\n\\n![Task 8 Image 2](img/Unit%2042%20_HTB-Sherlock_-1749482222681.webp)\\n\\n![Task 8 Image 3](img/Unit%2042%20_HTB-Sherlock_-1749482189208.webp)\\n\\nNow looking at the payload information for this log entry we find the time & date of the process termination, which is **`2024-02-14 03:41:58`**. Note that double clicking on a cell in Timeline Explorer will present the full contents of the cell.\\n\\n![Task 8 Image 1](img/Unit%2042%20_HTB-Sherlock_-1749482299926.webp)\\n\\n![Task 8 Image 2](img/Unit%2042%20_HTB-Sherlock_-1749482332059.webp)\\n\\n## Timeline of Events\\n\\n- `2024-02-14 03:41:25` - User on the soon-to-be-infected machine downloads malicious file from Dropbox cloud storage using Firefox web browser. Malicious file is named `Preventivo24.02.14.exe.exe`, and is downloaded to the users downloads folder.\\n- `2024-02-14 03:41:48` - User executes the malicious file. Malware attempts to access `www.example.com`, possibly to test internet connection.\\n- `2024-02-14 03:41:57` - Malware creates network connection to IP `93.184.216.34`.\\n- `2024-02-14 03:41:57` - `Preventivo24.02.14.exe.exe` process downloads malicious files and scripts to  `C:\\\\Users\\\\CyberJunkie\\\\AppData\\\\Roaming\\\\Photo and Fax Vn\\\\Photo and vn 1.1.2\\\\install\\\\F97891C\\\\` creating sub-directories as well.\\n- `2024-02-14 03:41:57` - `Preventivo24.02.14.exe.exe` executes installer  file that was downloaded via the command, infecting the system:\\n  - `\\"C:\\\\Windows\\\\system32\\\\msiexec.exe\\" /i \\"C:\\\\Users\\\\CyberJunkie\\\\AppData\\\\Roaming\\\\Photo and Fax Vn\\\\Photo and vn 1.1.2\\\\install\\\\F97891C\\\\main1.msi\\" AI_SETUPEXEPATH=C:\\\\Users\\\\CyberJunkie\\\\Downloads\\\\Preventivo24.02.14.exe.exe SETUPEXEDIR=C:\\\\Users\\\\CyberJunkie\\\\Downloads\\\\ EXE_CMD_LINE=\\"/exenoupdates  /forcecleanup  /wintime 1707880560  \\" AI_EUIMSI=\\"\\"`\\n- `2024-02-14 03:41:58` - `Preventivo24.02.14.exe.exe` deletes all downloaded files, directories, and scripts downloaded from IP address.\\n- `2024-02-14 03:41:58` -  `Preventivo24.02.14.exe.exe` terminates its process after downloading malicious files from IP address.\\n\\n## \ud83d\udd11 Key Takeaways\\n\\n- **Effective Use of Sysmon Logs**: Understanding Sysmon event IDs is critical for detecting suspicious behavior.\\n- **PowerShell for Log Analysis**: Leveraging `Get-WinEvent`, filtering of a given log file can be accomplished.\\n- **Timelining with EvtxECmd & Timeline Explorer**: Parsing `.evtx` files into `.csv` and analyzing them in Timeline Explorer provided a powerful method to sift through and correlate event data."},{"id":"CrownJewel2-Sherlock","metadata":{"permalink":"/blog/CrownJewel2-Sherlock","source":"@site/blog/2025-04-30-CrownJewel02/index.md","title":"CrownJewel 2 (HTB-Sherlock)","description":"HTB Sherlock CrownJewel 2 investigation focused on NTDS exfiltration and timeline analysis.","date":"2025-04-30T00:00:00.000Z","tags":[{"inline":true,"label":"hackthebox","permalink":"/blog/tags/hackthebox"},{"inline":true,"label":"DFIR","permalink":"/blog/tags/dfir"},{"inline":true,"label":"DigitalForensics","permalink":"/blog/tags/digital-forensics"},{"inline":true,"label":"ActiveDirectory","permalink":"/blog/tags/active-directory"},{"inline":true,"label":"NTDSDump","permalink":"/blog/tags/ntds-dump"},{"inline":true,"label":"ESENT","permalink":"/blog/tags/esent"},{"inline":true,"label":"TimelineExplorer","permalink":"/blog/tags/timeline-explorer"},{"inline":true,"label":"LogAnalysis","permalink":"/blog/tags/log-analysis"},{"inline":true,"label":"ForensicTools","permalink":"/blog/tags/forensic-tools"},{"inline":true,"label":"EricZimmermanTools","permalink":"/blog/tags/eric-zimmerman-tools"}],"readingTime":9.3,"hasTruncateMarker":true,"authors":[{"name":"Dario Cruz","title":"Maintainer of DarioCruz.dev","url":"https://github.com/dario-cruz","imageURL":"https://github.com/dario-cruz.png","key":"dcruz","page":null}],"frontMatter":{"slug":"CrownJewel2-Sherlock","title":"CrownJewel 2 (HTB-Sherlock)","description":"HTB Sherlock CrownJewel 2 investigation focused on NTDS exfiltration and timeline analysis.","keywords":["Hack The Box","Sherlock","CrownJewel","DFIR","NTDS"],"image":"/img/itsmedario.webp","authors":["dcruz"],"tags":["hackthebox","DFIR","DigitalForensics","ActiveDirectory","NTDSDump","ESENT","TimelineExplorer","LogAnalysis","ForensicTools","EricZimmermanTools"],"enableComments":true},"unlisted":false,"prevItem":{"title":"Unit42 (HTB-Sherlock)","permalink":"/blog/Unit42-Sherlock"},"nextItem":{"title":"CrownJewel 1 (HTB-Sherlock)","permalink":"/blog/CrownJewel1-Sherlock"}},"content":"![CrownJewel 2 - MainTitle](img/CrownJewel%202%20_HTB-Sherlock_-1745940973663.webp)\\nCrownJewel 2 is the final Sherlock in the Hack the Box *Detecting Active Directory Attacks* track. It\'s been rewarding tackling these labs and getting more exposure to the various tools of the trade when it comes to blue teaming in cyber.\\n\x3c!-- truncate --\x3e\\n\\n## Scenario\\n\\n*Forela\'s Domain environment is pure chaos. Just got another alert from the Domain controller of NTDS.dit database being exfiltrated. Just one day prior you responded to an alert on the same domain controller where an attacker dumped NTDS.dit via vssadmin utility. However, you managed to delete the dumped files kick the attacker out of the DC, and restore a clean snapshot. Now they again managed to access DC with a domain admin account with their persistent access in the environment. This time they are abusing ntdsutil to dump the database. Help Forela in these chaotic times!!*\\n\\n## The Files\\n\\nIn typical Sherlock fashion we have a single `.zip` file that contains some files for the investigation process. In the case of this investigation, extracting the archive we can see a folder called `Artifacts` that has a set of `.evtx` files. Each of the log files pertain to a different log provider, Application, Security, and System.\\n\\n![The Files](img/CrownJewel%202%20_HTB-Sherlock_-1745867070096.webp)\\n\\n## Task 1\\n\\n*When utilizing ntdsutil.exe to dump NTDS on disk, it simultaneously employs the Microsoft Shadow Copy Service. What is the most recent timestamp at which this service entered the running state, signifying the possible initiation of the NTDS dumping process?*\\n\\nService start/stop and other related conditions are logged by the SYSTEM log provider. We should take a look at the SYSTEM `.evtx` file to take a look. For the sake of enhancing learning and also getting more practice with [Eric Zimmerman\'s Forensic Tools](https://ericzimmerman.github.io/#!index.md), I will be making use of EvtxECmd and Timeline Explorer for analysis.\\n\\n![Task 1 Image 1](img/CrownJewel%202%20_HTB-Sherlock_-1745869293445.webp)\\n\\nIn the above I processed the `SYSTEM.evtx` log file using the tool. This parses and formats the log file into a `.csv` file that can be viewed inside of Timeline Explorer, allowing for viewing and filtering of log data in ways the Windows Event Viewer cannot. I also did this for the rest of the log files present in the artifacts folder.\\n\\n![Task 1 Log Parsing](img/CrownJewel%202%20_HTB-Sherlock_-1745869425586.webp)\\n\\nOpening the new `system.csv` file in Timeline Explorer, I filtered the *Map Description* column for the term *started*, pertaining to Service started or stopped. Then I filtered the *Payload Data* column for the word *shadow*. This was sufficient to bring up all events that pertained to the starting/stopping of the Volume Shadow Copy service.\\n\\n![Task 1 Log Analysis 1](img/CrownJewel%202%20_HTB-Sherlock_-1745870240328.webp)\\n\\nFound 4 logs in total, the most recent of which being the starting of the Volume Shadow copy service on `05/15/2024 05:39:55`. Take note that when `EvtwECmd` parses log files, it normalizes the time format to UTC.\\n\\n![Task 1 Log Analysis 2](img/CrownJewel%202%20_HTB-Sherlock_-1745870799892.webp)\\n\\nChanging the time/date format to HTB flag requirements, the task flag would be, **`2024-05-15 05:39:55`**.\\n\\n![Task 1 Flag](img/CrownJewel%202%20_HTB-Sherlock_-1745870834265.webp)\\n\\n## Task 2\\n\\n*Identify the full path of the dumped NTDS file.*\\n\\nThis time, we will load up our parsed application logs in Timeline Explorer. The normal path for the NTFS `ntds.dit` database file is `C:\\\\Windows\\\\NTDS\\\\`, any deviation from this would indicate that malicious activity is going on related to the database file. Opening the file, I filtered the logs via the find function and took a look at the results.\\n\\n![Task 2 Log Analysis](img/CrownJewel%202%20_HTB-Sherlock_-1745871728075.webp)\\n\\nIn the image above we are focused on the payload data of each log event. Taking a look toward the bottom of the log results we can see entries that pertain to the directory **` C:\\\\Windows\\\\Temp\\\\dump_tmp\\\\Active Directory\\\\ntds.dit`**. The related event ID is 325 and is a log generated when a new database is created.\\n\\nAs it turns out, this directory is indeed the task flag.\\n\\n![Task 2 Flag](img/CrownJewel%202%20_HTB-Sherlock_-1745872359270.webp)\\n\\n## Task 3\\n\\n*When was the database dump created on the disk?*\\n\\nGoing back to the same event log and checking the time, we can see that the database dump was created on **`2024-05-15 05:39:56`**.\\n\\n![Task 3 Log Aanlysis](img/CrownJewel%202%20_HTB-Sherlock_-1745872867566.webp)\\n\\n![Task 3 Flag](img/CrownJewel%202%20_HTB-Sherlock_-1745873027193.webp)\\n\\n## Task 4\\n\\n*When was the newly dumped database considered complete and ready for use?*\\n\\nReviewing the parsed application logs in Timeline Explorer, we can see an event a few seconds after where the ntds database was detached, this signifies that the dump of the database was completed and thus, the time of this event should be the task flag.\\n\\n![Task 4 Log Analysis](img/CrownJewel%202%20_HTB-Sherlock_-1745934084462.webp)\\n\\nThe task flag in this case being: **`2024-05-15 05:39:58`**\\n\\n![Task 4 Flag](img/CrownJewel%202%20_HTB-Sherlock_-1745934160948.webp)\\n\\n## Task 5\\n\\n*Event logs use event sources to track events coming from different sources. Which event source provides database status data like creation and detachment?*\\n\\nIn Windows when logs are generated they come from different providers. Providers are tasked with logging information specific to a type of action, application, OS function, etc. They allow for tracking just like the task describes. Finding the provider generated logs is a simple task and is made even simpler via the parsing done by *EvtwECmd*. In Timeline Explorer all we need to do is adjust the filtering and the columns to clearly see that the provider for creation and detachment of databases comes from the **`ESENT`** provider.\\n\\n![Task 5 Log Analysis](img/CrownJewel%202%20_HTB-Sherlock_-1745934490712.webp)\\n\\n![Task 5 Flag](img/CrownJewel%202%20_HTB-Sherlock_-1745934523141.webp)\\n\\n## Task 6\\n\\n*When ntdsutil.exe is used to dump the database, it enumerates certain user groups to validate the privileges of the account being used. Which two groups are enumerated by the ntdsutil.exe process? Give the groups in alphabetical order joined by comma space.*\\n\\nDid some research into what event IDs pertain to the enumeration of groups on a given environment. I found that event ID `4799` logs when a security-enabled local group is enumerated. [^2] These events are logged to the security section event logs so let\'s start there in our search.\\n[^2]: https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/event-4799\\n\\n![Task 6 Log Analysis](img/CrownJewel%201%20_HTB-Sherlock_-1745950267447.webp)\\n\\nLooking at the parse security log, check the image above, I filtered for the event ID `4799` and I also observed that there are 3 payload columns, of which Payload Data 1 contains the target group for enumeration and Payload Data 3 contains the process carrying out the enumeration. I filtered for `ntds` in column 3 as well. With the filters applied you can see that around the same time that the ntds database was dumped, we have multiple enumerations for the *Administrators* and *Backup Operators* groups.\\n\\n![Task 6 Flag](img/CrownJewel%201%20_HTB-Sherlock_-1745950559565.webp)\\n\\n## Task 7\\n\\n*Now you are tasked to find the Login Time for the malicious Session. Using the Logon ID, find the Time when the user logon session started.*\\n\\nAt the start of this Sherlock investigation we are given the key detail that we are inside of an\\nActive Directory environment. In most cases we should be looking for Kerberos authentication of some kind when a user logs into a machine or the domain controller. In AD environments Kerberos is used primarily when the client and the target server/services are all on the same domain/domain-joined. [^3]\\n[^3]: https://www.hackthebox.com/blog/what-is-kerberos-authentication#:~:text=Kerberos%20is%20the%20default%20protocol,authenticate%20them%20via%20mutual%20authentication.\\n\\nWith that in mind, what event IDs pertain to Kerberos authentication? Well if you haven\'t read my blog post on [Kerberoasting](https://www.dariocruz.dev/blog/Kerberoasting-Explained) you should check it out. It has details related to how the Kerberos authentication process is carried out, and how threat actors exploit the process. For the sake of time and to focus on obtaining the task flag I will list the event ID\'s what we need here.\\n\\n- `4768` - A Kerberos Authentication Ticket (TGT) was requested. [^4]\\n- `4769` - A Kerberos service ticket was requested. [^5]\\n[^4]: https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/event-4768\\n[^5]: https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/event-4769\\n\\n![Task 7 Log Analysis](img/CrownJewel%202%20_HTB-Sherlock_-1745953315621.webp)\\n\\nIn Timeline Explorer we have the ability to group events via column values, in the image above I grouped all the events by event ID. We can see that we have a count of 3 events for event ID `4768` and 7 for event ID `4769`.\\n\\nDigging deeper into the log details I hid all of the unneeded columns, focusing the time of event, description, and payload data of the filtered event logs. We can see that a *Kerberos ticket granting ticket*, was requested and granted for the *Forela/Administrator* account. This was followed up with a service ticket request at the exact same time, meaning that the time of malicious session was **`2024-05-15 05:36:31`**.\\n\\n![Task 7 Flag](img/CrownJewel%202%20_HTB-Sherlock_-1745954409849.webp)\\n\\n## \ud83d\udd11 Key Takeaways\\n\\n- \ud83e\udded Parsing `.evtx` logs with **EvtxECmd** and loading them into **Timeline Explorer** gave us the flexibility to filter, search, and correlate events in a way that the standard Event Viewer just doesn\u2019t allow. This workflow continues to prove itself useful across these Sherlock labs.\\n- \ud83d\udd75\ufe0f\u200d\u2642\ufe0f Attackers leveraged the **Volume Shadow Copy Service** as part of the NTDS dump. Tracking when this service starts can clue us in to the initial stages of database exfiltration activity.\\n- \ud83d\udcc2 Any time you see the `ntds.dit` file show up outside of its default location at `C:\\\\Windows\\\\NTDS\\\\`, alarms should go off. In this case, it showed up in a temp directory, which is a strong indicator of suspicious behavior.\\n- \ud83e\uddfe Logs from the **ESENT** provider helped us understand the lifecycle of the NTDS database\u2014creation, detachment, and overall status. If the database gets detached, odds are someone finished dumping it.\\n- \ud83d\udd10 Group enumeration showed up under **Event ID 4799**, and we were able to confirm that `ntdsutil.exe` queried both the *Administrators* and *Backup Operators* groups. This step is part of validating that the attacker has the necessary privileges to pull off the dump.\\n- \u23f1\ufe0f Pulling authentication details using **Event IDs 4768 and 4769** helped us determine the exact login time for the attacker\u2019s session. Kerberos logs are a solid place to start when tracing malicious logons in Active Directory environments.\\n\\nAll in all, this lab reinforced the importance of knowing where to look, how to correlate logs across multiple providers, and how to piece together the timeline of an attack from what the system leaves behind."},{"id":"CrownJewel1-Sherlock","metadata":{"permalink":"/blog/CrownJewel1-Sherlock","source":"@site/blog/2025-04-26-CrownJewel01/index.md","title":"CrownJewel 1 (HTB-Sherlock)","description":"HTB Sherlock CrownJewel 1 investigation focused on NTDS.dit and DC triage.","date":"2025-04-26T00:00:00.000Z","tags":[{"inline":true,"label":"hackthebox","permalink":"/blog/tags/hackthebox"},{"inline":true,"label":"Log Analysis","permalink":"/blog/tags/log-analysis"},{"inline":true,"label":"NTDS","permalink":"/blog/tags/ntds"},{"inline":true,"label":"VolumeShadowCopy","permalink":"/blog/tags/volume-shadow-copy"},{"inline":true,"label":"MFTAnalysis","permalink":"/blog/tags/mft-analysis"},{"inline":true,"label":"Windows Forensics","permalink":"/blog/tags/windows-forensics"},{"inline":true,"label":"Digital Forensics","permalink":"/blog/tags/digital-forensics"},{"inline":true,"label":"Active Directory","permalink":"/blog/tags/active-directory"},{"inline":true,"label":"EricZimmermanTools","permalink":"/blog/tags/eric-zimmerman-tools"}],"readingTime":11.5,"hasTruncateMarker":true,"authors":[{"name":"Dario Cruz","title":"Maintainer of DarioCruz.dev","url":"https://github.com/dario-cruz","imageURL":"https://github.com/dario-cruz.png","key":"dcruz","page":null}],"frontMatter":{"slug":"CrownJewel1-Sherlock","title":"CrownJewel 1 (HTB-Sherlock)","description":"HTB Sherlock CrownJewel 1 investigation focused on NTDS.dit and DC triage.","keywords":["Hack The Box","Sherlock","CrownJewel","NTDS","Windows forensics"],"image":"/img/itsmedario.webp","authors":["dcruz"],"tags":["hackthebox","Log Analysis","NTDS","VolumeShadowCopy","MFTAnalysis","Windows Forensics","Digital Forensics","Active Directory","EricZimmermanTools"],"enableComments":true},"unlisted":false,"prevItem":{"title":"CrownJewel 2 (HTB-Sherlock)","permalink":"/blog/CrownJewel2-Sherlock"},"nextItem":{"title":"Campfire 2 (HTB-Sherlock)","permalink":"/blog/Campfire2-Sherlock"}},"content":"![CrownJewel 1 - Main Title](img/CrownJewel%201%20_HTB-Sherlock_-1745940963342.webp)\\n\\nWe are down to the last two Sherlock labs to complete the track **Detecting Active Directory Attacks**. Let\'s start the next investigation and continue our learning.\\n\x3c!-- truncate --\x3e\\n\\n![Active Directory Path](img/CrownJewel%201%20_HTB-Sherlock_-1744036227329.webp)\\n\\n## Scenario\\n\\n*Forela\'s domain controller is under attack. The Domain Administrator account is believed to be compromised, and it is suspected that the threat actor dumped the NTDS.dit database on the DC. We just received an alert of vssadmin being used on the DC, since this is not part of the routine schedule we have good reason to believe that the attacker abused this LOLBIN utility to get the Domain environment\'s crown jewel. Perform some analysis on provided artifacts for a quick triage and if possible kick the attacker as early as possible.*\\n\\nOkay so we have some key details from this scenario description of the incident. The domain admin account has been compromised and it is suspected that the threat actor dumped the NTDS.dit database.\\n\\nI went ahead and looked up some details about NTDS.dit, and found TTP information related to the actions taken in this scenario on the MITRE ATT&CK website: [OS Credential Dumping: NTDS](https://attack.mitre.org/techniques/T1003/003/).\\n\\n***Attack Details:***\\n\\n- NTDS File location on domain controller: `%SystemRoot&\\\\NTDS\\\\Ntds.dit`\\n- NTDS File allows for exporting of AD data base, this allows credential access.\\n- Built in Windows tool , `ntdsutil.exe` can be used to access database contained in `Ntds.dit` file, as well as PowerShell commands and Python tools.\\n\\n***Detection:***\\n\\n- Command Execution on DC: Look for event IDs `4688` & `1(Sysmon)`. Investigate commands targeting `NTDS.dit` file and path.\\n- File Access: Events `4656` and `4663` (Microsoft Windows Security Auditing). Look for users requesting access to NTDS file or accessing file objects related to NTDS.dit.\\n\\nNow we are armed with key information about indicators of this type of attack. Let\'s move on to the provided files.\\n\\n## The Files\\n\\nExtracting the provided zip file, we have 3 `.etwv` log files, all of which pertain to a different log provider, coming from the affected DC.\\n\\n![Files 01](img/CrownJewel%201%20_HTB-Sherlock_-1745414751655.webp)\\n\\nWe also have what looks to be prefetch files taken at the time of attack. This includes the `$MFT` file, which includes all the file permissions and actions that have taken place on the system since Windows install.\\n\\n![Files 02](img/CrownJewel%201%20_HTB-Sherlock_-1745414769147.webp)\\n\\nWe will probably be using Eric Zimmerman\'s tool suite, which includes tools like `MFTCmd` and `Timeline Explorer` to investigate changes to files on the system at the time of the incident.\\n\\n## Task 1\\n\\n*Attackers can abuse the vssadmin utility to create volume shadow snapshots and then extract sensitive files like NTDS.dit to bypass security mechanisms. Identify the time when the Volume Shadow Copy service entered a running state.*\\n\\n### Volume Shadow Service\\n\\nVSS or volume shadow service is a backup mechanism present in later versions of the Windows OS, it allows for automatic incremental backup of all files on a given disk or partition. It\'s common for organizations to enable the service as a way to mitigate the effects of Malware and Ransomware, providing a snapshot to restore a system to, in the event that an incident of this type takes place.\\n\\nThreat actors have taken note of this behavior, so it is common for threat actors to target and attempt to delete volume shadow copies and disable the service entirely.\\n[^1]\\n[^1]: https://blogs.vmware.com/security/2022/09/threat-report-illuminating-volume-shadow-deletion.html\\nIn this case the threat actors are taking advantage of the service to gain access to sensitive files. They have enabled the VSS service, so it is wise to look for events the pertain to the starting of the VSS service.\\n\\nDoing some research as to the event IDs associated with the starting of services and also the starting of the VSS service specifically, I found the following:\\n\\n- `7036` - Service has entered a state *(Starting, Stopping, Paused, Resumed)*\\n- `8224` - VSS Service shutdown due to timeout.\\n- `8225` - VSS Service shutdown due to Service Control Manager event.\\n\\n### Log Analysis\\n\\nFirst, I will open the `SYSTEM.evtx` file as service changes (Event 7036) are logged there. Looking at the logs we can see a lot of events pertaining to the changing of service statuses.\\n\\n![Log Analysis 01](img/CrownJewel%201%20_HTB-Sherlock_-1745415461505.webp)\\n\\nScrolling through the logs, I found an entry for the VSS starting at `11:42 PM` on `May 13th 2024`. Take note that this timestamp is in my local time so for the flag and most HTB flags, the time and date need to be converted to UTC.\\n\\n![Log Analysis 02](img/CrownJewel%201%20_HTB-Sherlock_-1745415561908.webp)\\n\\nConverting the time and date to UTC I got the task flag, which is **`2024-05-14 03:42:16`**.\\n\\n![Task 1 Flag](img/CrownJewel%201%20_HTB-Sherlock_-1745416559728.webp)\\n\\n## Task 2\\n\\n*When a volume shadow snapshot is created, the Volume shadow copy service validates the privileges using the Machine account and enumerates User groups. Find the two user groups the volume shadow copy process queries and the machine account that did it.*\\n\\nLet\'s focus our attention to what events would be generated in this event. The shadow copy service should generate some sort of event for the action of a snapshot being created. After completing some research I found the following events to be of interest:\\n\\n- `8226` - VSS successful creation of snapshot.\\n- `12289` - Detailed information about stages of the snapshot process.\\n- `12292` - Detailed Information about writer components used during snapshot creation.\\n\\nI looked through the SYSTEM event logs but, did not find anything related to these event IDs. Looking at the SECURITY event logs provided did produce some insight. Around the same time that the Volume Shadow Copy service was started there are events pertaining to Event ID `4799`, which logs enumeration of members of a security-enabled group. Also, the log details state that the originating process is `VSSVC.exe`, which is the Volume Shadow Copy service.\\n\\n![Task 2 VSS Logs](img/CrownJewel%201%20_HTB-Sherlock_-1745508093233.webp)\\n\\nThere are eight logs in total that are related to enumeration, coming from the Volume Shadow Copy process. They all make use of the account name **`DC01$`** and the user groups that were targeted were, **`Administrators`**, and **`Backup Operators`**.\\n\\n![Task 2 Logs 02](img/CrownJewel%201%20_HTB-Sherlock_-1745508337417.webp)\\n\\nPutting these groups in the order in which they were used and in the flags requested format, we get **`Administrators, Backup Operators, DC01$`**, which is confirmed to be the task flag.\\n\\n![Task 2 Flag](img/CrownJewel%201%20_HTB-Sherlock_-1745508585553.webp)\\n\\n## Task 3\\n\\n*Identify the Process ID (in Decimal) of the volume shadow copy service process.*\\n\\nThis information can be gathered from the same set of logs from Task 2. In the log details the process ID of the Volume Shadow Copy service is **`0x1190`**.\\n\\n![Task 3 Logs 01](img/CrownJewel%201%20_HTB-Sherlock_-1745508772402.webp)\\n\\nThe value is in Hexadecimal, so we have to convert it. Converting it to decimal we get a value of **`4496`**, which is the task flag.\\n\\n![Task 3 Flag](img/CrownJewel%201%20_HTB-Sherlock_-1745509011047.webp)\\n\\n## Task 4\\n\\n*Find the assigned Volume ID/GUID value to the Shadow copy snapshot when it was mounted.*\\n\\nFor this task we should focus our attention on the NTFS log file provided. Events related to the mounting and unmounting of volumes should be logged there and provide the needed insight to obtain the task flag. Again the start of the Volume Shadow Copy process happened at *5/13/2024 11:42:16 PM EST* or *5/14/2024 03:42:16 AM UTC*, so we should look for mount events after this time.\\n\\nLooking through the logs we can see and event 4 at 5/13/2023 11:44:22 PM EST, which signifies a volume mount operation. This took place a few minutes after the start of the shadow copy service.\\n\\nThe log details provide a `Volume correlation ID`, which is used by the service to track the creation of snapshots.  This is also the value that we are looking for.\\n\\n![Task 4 Logs](img/CrownJewel%201%20_HTB-Sherlock_-1745511044770.webp)\\n\\nThe Volume correlation ID being: **`{06c4a997-cca8-11ed-a90f-000c295644f9}`**.\\n\\n![Task 4](img/CrownJewel%201%20_HTB-Sherlock_-1745518969703.webp)\\n\\n## Task 5\\n\\n*Identify the full path of the dumped NTDS database on disk.*\\n\\nIn the very start of this lab, I detailed out the list of files that we where given as a part of the investigation. Inside of the Artifacts folder and further once more into the C folder, we can see that we have an `$MFT` file. This is the master file record, which is a database present on NTFS systems. It contains file attributes such as time of creation, time of last edit, etc, and is an invaluable artifact to have when investigating security incidents which would have involved some sort of file manipulation.\\n\\nIn order to read the MFT file and view the attributes, I will be making use of a popular tool created by Eric Zimmerman, called MFT Explorer. The tool has a well laid out interface so that we can navigate through all the file data/attributes stored. Below I have loaded the MFT file into the tool.\\n\\n![MFT Explorer 01](img/CrownJewel%201%20_HTB-Sherlock_-1745519896111.webp)\\n\\nIn the above you can see that we have a similar file/folder structure to a normal windows explorer view but, we also have a hex view and a details pane. Where do we go from here? Where would the `ntds.dit` file be stored? Well, we have a few clues from the previous tasks. We know that the Administrators group was enumerated when VSS made a shadow copy. Looking at the users folder, the only user account of note is Administrator. Digging into the Administrator accounts user folder, I checked the desktop, downloads, and documents folder. The documents folder has an folder in it that had an interesting name, `backup_sync_dc`.\\n\\n![MFT Explorer 02](img/CrownJewel%201%20_HTB-Sherlock_-1745520294560.webp)\\n\\nAlso, in the above image you can note that the time lines up with the timeline of events that we have observed so far. Timeline Explorer shows all times and dates in UTC. The time of folder creation was `05-14-2024 03:38:46`, which was a few minutes after the Volume Shadow Copy service was started.\\n\\nNavigating into the folder, we can see an `ntds.dit` file. These files normally do not reside inside of user folders so, this file being here is abnormal. Also, just like the folder, the creation time is in line with the events that have been observed.\\n\\n![MFT Explorer 03](img/CrownJewel%201%20_HTB-Sherlock_-1745520552812.webp)\\n\\nThe full path to the database/file being **`C:\\\\Users\\\\Administrator\\\\Documents\\\\backup_sync_dc\\\\ntds.dit`**.\\n\\n![Task 5 Flag](img/CrownJewel%201%20_HTB-Sherlock_-1745520637914.webp)\\n\\n## Task 6\\n\\n*When was newly dumped ntds.dit created on disk?*\\n\\nTaking another look at the image below note the creation time of the file. The time and date are already in UTC time, so no need to convert it.\\n\\n![Task 6 Log 01](img/CrownJewel%201%20_HTB-Sherlock_-1745520761151.webp)\\n\\nHack the box asks for the flag to be in YYYY-MM-DD HH:MM:SS format, so the complete flag is: **`2024-05-14 03:44:22`**.\\n\\n![Task 6 Flag](img/CrownJewel%201%20_HTB-Sherlock_-1745520897735.webp)\\n\\n## Task 7\\n\\n*A registry hive was also dumped alongside the NTDS database. Which registry hive was dumped and what is its file size in bytes?*\\n\\nIn the same folder as the `ntds.dit` file there is also a file with no file extension, called `SYSTEM`. Inside of the MFTExplorer application there are no details about the size of this file. I opted to convert the MFT file into `.csv` format, using MFTCmd, also another of Eric Zimmerman\'s tools. I learned about Eric\'s suite of forensic tools while completing the module *Intro to Digital Forensics* as a part of my learning for the HTB-CDSA.\\n\\n![Task 7 - PowerShell](img/CrownJewel%201%20_HTB-Sherlock_-1745848013959.webp)\\n\\nAfter conversion I opened up the file with Time Line Explorer and filtered for the folder path that both files resided in.\\n\\n![Task 7 - Logs](img/CrownJewel%201%20_HTB-Sherlock_-1745847983048.webp)\\n\\nFrom the image above you can see that the `SYSTEM` file is found in the directory, also we can see that the file size information is present in bytes. The complete flag being **`SYSTEM, 17563648`**.\\n\\n![Task 7 Flag](img/CrownJewel%201%20_HTB-Sherlock_-1745848309201.webp)\\n\\n## \ud83d\udd0d Key Takeaways\\n\\n- \ud83e\uddf0 **Leveraging Eric Zimmerman\'s Tools for Deep Analysis**  \\n  Utilizing tools like `EvtxECmd` and `MFTECmd` allowed for efficient parsing of `.evtx` logs and the `$MFT` file. Coupled with `Timeline Explorer`, this setup provided a streamlined approach to sifting through vast amounts of data.\\n\\n- \ud83d\udd75\ufe0f **Identifying Service Start Events**  \\n  Filtering the `SYSTEM.evtx` log for Event ID `7036` was instrumental in pinpointing when the Volume Shadow Copy Service entered the running state\u2014a critical indicator of potential malicious activity.\\n\\n- \ud83d\udcc1 **Uncovering Suspicious File Paths**  \\n  Analysis of the `$MFT` revealed the creation of `ntds.dit` in an unusual directory: `C:\\\\Users\\\\Administrator\\\\Documents\\\\backup_sync_Dc\\\\`. Such deviations from standard file locations can be indicative of unauthorized actions.\\n\\n- \ud83d\udd52 **Correlating Timestamps for Event Sequencing**  \\n  By examining the creation times of key files, a timeline of the attack was established, providing clarity on the sequence of malicious events.\\n\\n- \ud83e\uddfe **Detecting Registry Hive Exfiltration**  \\n  The presence of the `SYSTEM` registry hive alongside the dumped `ntds.dit` file highlighted the attacker\'s intent to extract comprehensive system information, emphasizing the need to monitor for such activities.\\n\\n- \ud83d\udd10 **Understanding the Role of Built-in Utilities in Attacks**  \\n  The misuse of legitimate Windows utilities, like `vssadmin`, underscores the importance of monitoring and controlling the use of such tools within an environment."},{"id":"Campfire2-Sherlock","metadata":{"permalink":"/blog/Campfire2-Sherlock","source":"@site/blog/2025-04-04-Campfire2-Sherlock/index.md","title":"Campfire 2 (HTB-Sherlock)","description":"HTB Sherlock Campfire 2 investigation focused on AS-REP roasting and event logs.","date":"2025-04-04T00:00:00.000Z","tags":[{"inline":true,"label":"hackthebox","permalink":"/blog/tags/hackthebox"},{"inline":true,"label":"Log Analysis","permalink":"/blog/tags/log-analysis"},{"inline":true,"label":"AsRep","permalink":"/blog/tags/as-rep"},{"inline":true,"label":"AsREP Roasting","permalink":"/blog/tags/as-rep-roasting"},{"inline":true,"label":"Event Logs","permalink":"/blog/tags/event-logs"},{"inline":true,"label":"Kerberoasting","permalink":"/blog/tags/kerberoasting"},{"inline":true,"label":"Kerberos","permalink":"/blog/tags/kerberos"},{"inline":true,"label":"Active Directory","permalink":"/blog/tags/active-directory"}],"readingTime":4.76,"hasTruncateMarker":true,"authors":[{"name":"Dario Cruz","title":"Maintainer of DarioCruz.dev","url":"https://github.com/dario-cruz","imageURL":"https://github.com/dario-cruz.png","key":"dcruz","page":null}],"frontMatter":{"slug":"Campfire2-Sherlock","title":"Campfire 2 (HTB-Sherlock)","description":"HTB Sherlock Campfire 2 investigation focused on AS-REP roasting and event logs.","keywords":["Hack The Box","Sherlock","Campfire","AS-REP roasting","Kerberos"],"image":"/img/itsmedario.webp","authors":["dcruz"],"tags":["hackthebox","Log Analysis","AsRep","AsREP Roasting","Event Logs","Kerberoasting","Kerberos","Active Directory"],"enableComments":true},"unlisted":false,"prevItem":{"title":"CrownJewel 1 (HTB-Sherlock)","permalink":"/blog/CrownJewel1-Sherlock"},"nextItem":{"title":"Campfire 1 (HTB-Sherlock)","permalink":"/blog/Campfire1-Sherlock"}},"content":"![Campfire2 - Main Title](img/Campfire%202%20_HTB-Sherlock_-1743777084051.webp)\\nOn to the second part of the Campfire Sherlock from Hack the Box. Again, if you have not read my [previous write-up on Campfire 1](https://www.dariocruz.dev/blog/Campfire1-Sherlock), go check it out. The aim is to complete all Sherlocks in the *Detecting Active Directory Attacks* track on HTB labs. Time to investigate!\\n\\n## The Scenario\\n\\n*Forela\'s Network is constantly under attack. The security system raised an alert about an old admin account requesting a ticket from KDC on a domain controller. Inventory shows that this user account is not used as of now so you are tasked to take a look at this. This may be an AsREP roasting attack as anyone can request any user\'s ticket which has preauthentication disabled.*\\n\x3c!-- truncate --\x3e\\n\\n## The Files\\n\\nFor this Sherlock scenario, we are given a single `.etwx` log file to analyze. We will be looking for AsREP roasting from the looks of things so we should be on the lookout for indicators of such.\\n\\n## Task 1\\n\\n**When did the ASREP Roasting attack occur, and when did the attacker request the Kerberos ticket for the vulnerable user?**\\n\\nOkay, let\'s open up that log file that we were given and take a look at the logs. For AsREP roasting, we should be on the hunt for malicious entries of event code `4768`, which correlate to Kerberos Authentication TGT requests.\\n\\nI went ahead and filtered the logs down to just event `4768` entries.\\n![Log Filtering Event Viewer](img/Campfire%202%20_HTB-Sherlock_-1743778210920.webp)\\n\\nLooking through the now filtered results, see a suspicious request from a computer that we know is compromised. The user, `Arthur.Kyle`, had their computer compromised and used for a Kerberoasting attack. We know this from the previous investigation [Campfire 1](https://www.dariocruz.dev/blog/Campfire1-Sherlock). We also know that the IP address of the computer was `172.17.79.129`, from answering Task 3 of said investigation. Looks like *Kerberos pre-authentication* was not enabled for this user.\\n![Event 4768 ASREP](img/Campfire%202%20_HTB-Sherlock_-1743779064830.webp)\\n\\nThe time of the AsREP roasting was `5/29/2004 @ 2:36:40 AM` EST. Converting that into UTC time and the format requested we get the task flag.\\n\\n**Task Flag:** `2024-05-29 06:36:40`\\n![Task 1 Flag](img/Campfire%202%20_HTB-Sherlock_-1743779174365.webp)\\n\\n## Task 2\\n\\n**Please confirm the User Account that was targeted by the attacker.**\\n\\nIn the previous task, we already stated that the user that was targeted for the attack was `arthur.kyle`, which you can see from the log of the initial AsREP attack.\\n![Task Log Username](img/Campfire%202%20_HTB-Sherlock_-1743779740125.webp)\\n\\n**Task Flag:** `arthur.kyle`\\n![Task 2 Flag](img/Campfire%202%20_HTB-Sherlock_-1743779763383.webp)\\n\\n## Task 3\\n\\n**What was the SID of the account?**\\n\\nAgain, in the same event for the initial AsREP roasting attack. We have the SID of the targeted user account `arthur.kyle`, which is `S-1-5-21-3239415629-1862073780-2394361899-1601`\\n![Task Log SID Value](img/Campfire%202%20_HTB-Sherlock_-1743779902196.webp)\\n\\n**Task Flag:** `S-1-5-21-3239415629-1862073780-2394361899-1601`\\n![Task 3 Flag](img/Campfire%202%20_HTB-Sherlock_-1743779957186.webp)\\n\\n## Task 4\\n\\n**It is crucial to identify the compromised user account and the workstation responsible for this attack. Please list the internal IP address of the compromised asset to assist our threat-hunting team.**\\n\\nYet again in the same event log, we can scroll down to the network details of the computer that made the request to the KDC. We can see that both the IPv6 & IPv4 addresses of the machine are present, as well as the port used. The IP address `172.17.79.129`.\\n![Task 4 Log Event IP](img/Campfire%202%20_HTB-Sherlock_-1743780301109.webp)\\n\\n**Task Flag:** `172.17.79.129`\\n![Task 4 Flag](img/Campfire%202%20_HTB-Sherlock_-1743780344408.webp)\\n\\n## Task 5\\n\\n**We do not have any artifacts from the source machine yet. Using the same DC Security logs, can you confirm the user account used to perform the ASREP Roasting attack so we can contain the compromised account/s?**\\n\\nOkay so looking through the log file in event viewer. I see two events that correlate with each other and give a picture of how the threat actor gained access to another account.\\n\\nIn the image below we can see that the user `arthur.klye`, and their computer, which we know are compromised, requested a Kerberos authentication ticket. *Note the IP address*\\n![Task 5 Event Log](img/Campfire%202%20_HTB-Sherlock_-1743780825164.webp)\\n\\nThe very next event logged is for *Kerberos Service Ticket Operations*, which allows for requesting service tickets for access to services on a given domain. This operation requires that a TGT be already issued for the requesting account. From the log information we can see that the username has changed. This potentially means that the threat actor used `arthur.kyle`\'s computer to request a TGT for another account that had more access. Also note that the event came from the same IP of `arthur.kyle`\'s machine.\\n![Task 5 Event Log Indicators](img/Campfire%202%20_HTB-Sherlock_-1743781208150.webp)\\n\\nTo further backup our hypothesis, after the service ticket was requested and granted for the user account `happy.grunwald`, there are two `5140` events logging that account accessing two shares, `\\\\\\\\*\\\\IPC$` & `\\\\\\\\*\\\\DC-Confidential`. The threat actor appears to be searching for sensitive data to exfiltrate.\\n\\n**Task Flag:** `happy.grunwald`\\n![Task 5 Flag](img/Campfire%202%20_HTB-Sherlock_-1743782725773.webp)\\n\\n## Investigation Complete\\n\\n![Sherlock Complet](img/Campfire%202%20_HTB-Sherlock_-1743782863475.webp)\\n\\n## Key Takeaways\\n\\n- AsREP roasting allows for threat actors to request service tickets for accounts that do not have *Kerberos pre-authentication enabled*. This allows threat actors to gain access to any services/resources provisioned for the target user."},{"id":"Campfire1-Sherlock","metadata":{"permalink":"/blog/Campfire1-Sherlock","source":"@site/blog/2025-04-03-Campfire1-Sherlock/index.md","title":"Campfire 1 (HTB-Sherlock)","description":"HTB Sherlock Campfire 1 investigation focused on Kerberoasting and log analysis.","date":"2025-04-03T00:00:00.000Z","tags":[{"inline":true,"label":"hackthebox","permalink":"/blog/tags/hackthebox"},{"inline":true,"label":"Log Analysis","permalink":"/blog/tags/log-analysis"},{"inline":true,"label":"PECmd","permalink":"/blog/tags/pe-cmd"},{"inline":true,"label":"Prefetch","permalink":"/blog/tags/prefetch"},{"inline":true,"label":"Event Logs","permalink":"/blog/tags/event-logs"},{"inline":true,"label":"Kerberoasting","permalink":"/blog/tags/kerberoasting"},{"inline":true,"label":"Kerberos","permalink":"/blog/tags/kerberos"},{"inline":true,"label":"Active Directory","permalink":"/blog/tags/active-directory"}],"readingTime":8.57,"hasTruncateMarker":true,"authors":[{"name":"Dario Cruz","title":"Maintainer of DarioCruz.dev","url":"https://github.com/dario-cruz","imageURL":"https://github.com/dario-cruz.png","key":"dcruz","page":null}],"frontMatter":{"slug":"Campfire1-Sherlock","title":"Campfire 1 (HTB-Sherlock)","description":"HTB Sherlock Campfire 1 investigation focused on Kerberoasting and log analysis.","keywords":["Hack The Box","Sherlock","Campfire","Kerberoasting","log analysis"],"image":"/img/itsmedario.webp","authors":["dcruz"],"tags":["hackthebox","Log Analysis","PECmd","Prefetch","Event Logs","Kerberoasting","Kerberos","Active Directory"],"enableComments":true},"unlisted":false,"prevItem":{"title":"Campfire 2 (HTB-Sherlock)","permalink":"/blog/Campfire2-Sherlock"},"nextItem":{"title":"Loggy (HTB-Sherlock)","permalink":"/blog/Loggy-Sherlock"}},"content":"![Campfire 1 Title Image](img/Camfire%201-MainTitle.webp)\\nHack the Box recently created some learning tracks for their Sherlock labs. I recently enrolled in the *Detecting Active Directory* track as I have already completed two of the Sherlocks included, [Noxious](https://www.dariocruz.dev/blog/Noxious-HTB-Sherlocks) and [Reaper](https://www.dariocruz.dev/blog/Reaper-HTB-Sherlocks). Campfire 1 is the first in the series in this track and pairs up well with my article on [Kerberoasting](https://www.dariocruz.dev/blog/Kerberoasting-Explained) as this investigation deals with a Kerberoasting attack. Let\'s get started!\\n\\n## The Scenario\\n\\n*Alonzo Spotted Weird files on his computer and informed the newly assembled SOC Team. Assessing the situation it is believed a Kerberoasting attack may have occurred in the network. It is your job to confirm the findings by analyzing the provided evidence. You are provided with: 1- Security Logs from the Domain Controller 2- PowerShell-Operational Logs from the affected workstation 3- Prefetch Files from the affected workstation*\\n\x3c!-- truncate --\x3e\\n\\n## The Files\\n\\nI took a look at the file confirming what was stated in the scenario of the investigation. We have a folder named `Triage` with two folders inside named, `Domain Controler` & `Workstation`. The `Domain Controller` folder has a single `.evtx` file named `SECURITY-DC`. The `Workstation` folder contains another `.evtx` file named `PowerShellOperational` and a folder that contains all of the Windows prefetch files taken at the time of attack.\\n\\n## Task 1\\n\\n**Analyzing Domain Controller Security Logs, can you confirm the date & time when the Kerberoasting activity occurred?**\\n\\nLet\'s take a look at the event log file that is present in the `Domain Controller` folder. Looking through the log file, and using information from my notes and also my [article on Kerberoasting](https://www.dariocruz.dev/blog/Kerberoasting-Explained), we should be looking for the event code `4769` which signifies a Kerberos ticket is being requested. We also need to take a look at the method of encryption that is used in this specific event as threat actors will attempt to downgrade the encryption standard used, in order to offline brute force the hash of the password.\\n\\nIn the logs I can see that there are a number of Kerberos ticket requests, most of which make use of `AES256_CTS_HMAC_SHA1_96`, which is standard for modern AD environments.\\n\\nLooking further we can see a suspicious ticket request at `5/20/2024 11:18:09 PM` that stands out from the rest.\\n\\n![Kerberoasting Event](img/Campfire%201%20_HTB-Sherlocks_-1743688910438.webp)\\nHere are the indicators:\\n\\n- Time of ticket request is off hours from business operations. (How\'s burning the midnight oil?)\\n- Ticket request encryption type is `0x17` which is the value for `RC4_HMAC` which is commonly used by threat actors for Kerberoasting.\\n- The ticket being requested is for the MSSQL services, which if granted could lead to data exfiltration or ransomware attacks.\\n\\nSo now we have time time and date that the Kerberoasting attack happened, which is `5/20/2024 11:18:09 PM` but, there is one more step that we have to do. We need to convert the time the event occurred to UTC as Windows Event Viewer converts all log times to that machine\'s local time.\\n\\n**Task Flag:** `2024-05-21 03:18:09`\\n![Task 1 Flag](img/Campfire%201%20_HTB-Sherlocks_-1743690011494.webp)\\n\\n## Task 2\\n\\n**What is the Service Name that was targeted?**\\n\\nThe flag for this task is present in the same event that we took a look at, detailing the start of the Kerberoasting attack.\\n\\n![Task 2 Event Details](img/Campfire%201%20_HTB-Sherlocks_-1743690124562.webp)\\n\\n**Task Flag:** `MSSQLService`\\n![Task 2 Flag](img/Campfire%201%20_HTB-Sherlocks_-1743690202430.webp)\\n\\n## Task 3\\n\\n**It is really important to identify the Workstation from which this activity occurred. What is the IP Address of the workstation?**\\n\\nLooking again at the same event log, towards the top of the event details we can see network information for the machine that initiated the request. Windows logs both the IPv6 and IPv4 addresses separated by an `:`.\\n\\n![Task 3 Event Details](img/Campfire%201%20_HTB-Sherlocks_-1743690384299.webp)\\n\\n**Task Flag:** `172.17.79.129`\\n![Task 3 Flag](img/Campfire%201%20_HTB-Sherlocks_-1743690425875.webp)\\n\\n## Task 4\\n\\n**Now that we have identified the workstation, a triage including PowerShell logs and Prefetch files are provided to you for some deeper insights so we can understand how this activity occurred on the endpoint. What is the name of the file used to Enumerate Active directory objects and possibly find Kerberoastable accounts in the network?**\\n\\nFirst step is to take a look at the PowerShell logs, we should be able to analyze and discern which file is being written to or accessed in order to carry out the enumeration of AD objects.\\n\\nLooking at the contents of the PowerShell log file we can see numerous events that are classified as warnings with the event code of `4104` which pertains to *PowerShell script block logging*. Each of the events of this type have one thing in common, they are all invoked by the file `powerview.ps1`.\\n![Task 4 Event Details](img/Campfire%201%20_HTB-Sherlocks_-1743691683435.webp)\\n\\n**Task Flag:** `powerview.ps1`\\n![Task 4 Flag](img/Campfire%201%20_HTB-Sherlocks_-1743691723646.webp)\\n\\n## Task 5\\n\\n**When was this script executed?**\\n\\nThe first instance of the `powerview.ps1` script being executed happened at `5/20/2024 11:16:32 PM` EST. We can discern this further and anticipate further executions via investigating the log details, which state at the top: `Creating Scriptblock text (1 of 20):`,. the event of which is followed by 19 more script block events.\\n\\nConverting the time of the event to UTC and to the format requested for the flag we get: `2024-05-21 03:16:32`.\\n\\n**Task Flag:** `2024-05-21 03:16:32`\\n![Task 5 Flag](img/Campfire%201%20_HTB-Sherlocks_-1743692232202.webp)\\n\\n## Task 6\\n\\n**What is the full path of the tool used to perform the actual kerberoasting attack?**\\n\\nOkay so we know that the enumeration and Kerberoasting attack came from the same machine. We should look through the prefetch files and look at suspicious file names or common names of tools used to carry out Kerberoasting attacks.\\n\\nLooks like we didn\'t have to look far, we have a file inside of the `\\\\2024-05-21T033012_triage_asset\\\\C\\\\Windows\\\\prefetch` directory named `Rubeus.exe`.\\n![](img/Campfire%201%20_HTB-Sherlocks_-1743692896710.webp)\\n\\nWe need to analyze the prefetch of this file for metadata that would allow us to determine when the file was first executed.\\n\\nFor this task I will make use of PECmd, which is a forensics tool created by [Eric Zimmerman](https://ericzimmerman.github.io/#!index.md) that allows for parsing of prefect files, displaying a wealth of metadata. I also read a guide on how to use the tool [here](https://bromiley.medium.com/tooling-thursday-pecmd-83d1d6d6346b). Thanks Matt B!\\n\\nUsing the guide and documentation I ran the tool using the `-f` flag specifying PECmd to scan the `RUBEUS.EXE-5873E24B.pf` file and got the following output.\\n\\n```powershell\\nPS C:\\\\Tools> .\\\\PECmd.exe -f \'C:\\\\Sherlocks\\\\Campfire 1\\\\Triage\\\\Workstation\\\\2024-05-21T033012_triage_asset\\\\C\\\\Windows\\\\prefetch\\\\RUBEUS.EXE-5873E24B.pf\'\\nPECmd version 1.5.1.0\\n\\nAuthor: Eric Zimmerman (saericzimmerman@gmail.com)\\nhttps://github.com/EricZimmerman/PECmd\\n\\nCommand line: -f C:\\\\Sherlocks\\\\Campfire 1\\\\Triage\\\\Workstation\\\\2024-05-21T033012_triage_asset\\\\C\\\\Windows\\\\prefetch\\\\RUBEUS.EXE-5873E24B.pf\\n\\nKeywords: temp, tmp\\n\\nProcessing C:\\\\Sherlocks\\\\Campfire 1\\\\Triage\\\\Workstation\\\\2024-05-21T033012_triage_asset\\\\C\\\\Windows\\\\prefetch\\\\RUBEUS.EXE-5873E24B.pf\\n\\nCreated on: 2024-05-21 05:02:37\\nModified on: 2024-05-21 03:18:09\\nLast accessed on: 2025-04-03 18:06:34\\n\\nExecutable name: RUBEUS.EXE\\nHash: 5873E24B\\nFile size (bytes): 86,612\\nVersion: Windows 10 or Windows 11\\n\\nRun count: 1\\nLast run: 2024-05-21 03:18:08\\n\\nVolume information:\\n\\n#0: Name: \\\\VOLUME{01d951602330db46-52233816} Serial: 52233816 Created: 2023-03-08 01:48:53 Directories: 56 File references: 178\\n\\nDirectories referenced: 56\\n\\n00: \\\\VOLUME{01d951602330db46-52233816}\\\\USERS\\n01: \\\\VOLUME{01d951602330db46-52233816}\\\\USERS\\\\ALONZO.SPIRE\\n02: \\\\VOLUME{01d951602330db46-52233816}\\\\USERS\\\\ALONZO.SPIRE\\\\APPDATA\\n03: \\\\VOLUME{01d951602330db46-52233816}\\\\USERS\\\\ALONZO.SPIRE\\\\APPDATA\\\\LOCAL\\n04: \\\\VOLUME{01d951602330db46-52233816}\\\\USERS\\\\ALONZO.SPIRE\\\\APPDATA\\\\LOCAL\\\\MICROSOFT\\n05: \\\\VOLUME{01d951602330db46-52233816}\\\\USERS\\\\ALONZO.SPIRE\\\\APPDATA\\\\LOCAL\\\\MICROSOFT\\\\WINDOWS\\n06: \\\\VOLUME{01d951602330db46-52233816}\\\\USERS\\\\ALONZO.SPIRE\\\\APPDATA\\\\LOCAL\\\\MICROSOFT\\\\WINDOWS\\\\SCHCACHE\\n--SNIP--\\n\\nFiles referenced: 109\\n\\n00: \\\\VOLUME{01d951602330db46-52233816}\\\\WINDOWS\\\\SYSTEM32\\\\NTDLL.DLL\\n01: \\\\VOLUME{01d951602330db46-52233816}\\\\USERS\\\\ALONZO.SPIRE\\\\DOWNLOADS\\\\RUBEUS.EXE (Executable: True)\\n02: \\\\VOLUME{01d951602330db46-52233816}\\\\WINDOWS\\\\SYSTEM32\\\\MSCOREE.DLL\\n03: \\\\VOLUME{01d951602330db46-52233816}\\\\WINDOWS\\\\SYSTEM32\\\\KERNEL32.DLL\\n04: \\\\VOLUME{01d951602330db46-52233816}\\\\WINDOWS\\\\SYSTEM32\\\\KERNELBASE.DLL\\n05: \\\\VOLUME{01d951602330db46-52233816}\\\\WINDOWS\\\\SYSTEM32\\\\LOCALE.NLS\\n06: \\\\VOLUME{01d951602330db46-52233816}\\\\WINDOWS\\\\SYSTEM32\\\\APPHELP.DLL\\n07: \\\\VOLUME{01d951602330db46-52233816}\\\\WINDOWS\\\\APPPATCH\\\\SYSMAIN.SDB\\n08: \\\\VOLUME{01d951602330db46-52233816}\\\\WINDOWS\\\\SYSTEM32\\\\ADVAPI32.DLL\\n09: \\\\VOLUME{01d951602330db46-52233816}\\\\WINDOWS\\\\SYSTEM32\\\\MSVCRT.DLL\\n10: \\\\VOLUME{01d951602330db46-52233816}\\\\WINDOWS\\\\SYSTEM32\\\\SECHOST.DLL\\n11: \\\\VOLUME{01d951602330db46-52233816}\\\\WINDOWS\\\\SYSTEM32\\\\RPCRT4.DLL\\n12: \\\\VOLUME{01d951602330db46-52233816}\\\\WINDOWS\\\\SYSTEM32\\\\BCRYPT.DLL\\n13: \\\\VOLUME{01d951602330db46-52233816}\\\\WINDOWS\\\\MICROSOFT.NET\\\\FRAMEWORK64\\\\V4.0.30319\\\\MSCOREEI.DLL\\n--SNIP--\\n```\\n\\nWe can see that the tool provides a list of directories and files that were referenced. In the list of files referenced we can see an entry for `RUBEUS.EXE`, with the full path to the malicious file being `C:\\\\users\\\\alonzo.spire\\\\downloads\\\\rubeus.exe`.\\n\\n**Task Flag:** `C:\\\\Users\\\\Alonzo.spire\\\\Downloads\\\\Rubeus.exe`\\n![Task 6 Flag](img/Campfire%201%20_HTB-Sherlocks_-1743704349168.webp)\\n\\n## Task 7\\n\\n**When was the tool executed to dump credentials?**\\n\\nFor the last and final task, the flag is in the output of the command used in the previous task. We run PECmd, on the target prefetch file, `RUBEUS.EXE-5873E24B.pf` and analyze the output.\\n\\nThe output displays a time value for the last time the executable was run, and lucky for us, the tool outputs the time in UTC.\\n\\n```powershell\\nExecutable name: RUBEUS.EXE\\nHash: 5873E24B\\nFile size (bytes): 86,612\\nVersion: Windows 10 or Windows 11\\n\\nRun count: 1\\nLast run: 2024-05-21 03:18:08\\n```\\n\\n**Task Flag:** `2024-05-21 03:18:08`\\n![Task 7 Flag](img/Campfire%201%20_HTB-Sherlocks_-1743704648642.webp)\\n\\n## Investigation Complete\\n\\n![Investigation Complete](img/Campfire%201%20_HTB-Sherlocks_-1743708501487.webp)\\n\\n## Key Takeaways\\n\\n- Windows Prefetch files are useful in forensics as they provide useful information like executable name, file path, number of executions, lists of DLLs and files accessed.\\n- PECmd is a useful tool for examining the metadata of prefetch files, allowing for investigation of these files straight from the command line. PECmd also has the ability to output to `.csv` and `.json` file types for further analysis with other tools."},{"id":"Loggy-Sherlock","metadata":{"permalink":"/blog/Loggy-Sherlock","source":"@site/blog/2025-03-19-Loggy-Sherlock/index.md","title":"Loggy (HTB-Sherlock)","description":"HTB Sherlock Loggy investigation focused on malware analysis and artifact review.","date":"2025-03-19T00:00:00.000Z","tags":[{"inline":true,"label":"hackthebox","permalink":"/blog/tags/hackthebox"},{"inline":true,"label":"Malware Analysis","permalink":"/blog/tags/malware-analysis"},{"inline":true,"label":"Ghidra","permalink":"/blog/tags/ghidra"},{"inline":true,"label":"FlareVM","permalink":"/blog/tags/flare-vm"},{"inline":true,"label":"strings","permalink":"/blog/tags/strings"},{"inline":true,"label":"grep","permalink":"/blog/tags/grep"},{"inline":true,"label":"reverse engineering","permalink":"/blog/tags/reverse-engineering"}],"readingTime":12.24,"hasTruncateMarker":true,"authors":[{"name":"Dario Cruz","title":"Maintainer of DarioCruz.dev","url":"https://github.com/dario-cruz","imageURL":"https://github.com/dario-cruz.png","key":"dcruz","page":null}],"frontMatter":{"slug":"Loggy-Sherlock","title":"Loggy (HTB-Sherlock)","description":"HTB Sherlock Loggy investigation focused on malware analysis and artifact review.","keywords":["Hack The Box","Sherlock","Loggy","malware analysis","incident response"],"image":"/img/itsmedario.webp","authors":["dcruz"],"tags":["hackthebox","Malware Analysis","Ghidra","FlareVM","strings","grep","reverse engineering"],"enableComments":true},"unlisted":false,"prevItem":{"title":"Campfire 1 (HTB-Sherlock)","permalink":"/blog/Campfire1-Sherlock"},"nextItem":{"title":"What I\'ve Learned - Network Traffic Analysis","permalink":"/blog/NetTrafficAnalysis"}},"content":"![Loggy Main Image](img/Loggy%20_HTB-Sherlocks_-1742397926286.webp)\\nHey all, it\'s been a while since my last Sherlock post but rest assured I am still out here studying and learning.\ud83e\udd13 Now let\'s dive into another investigation.\\n\\n## Scenario\\n\\n> Janice from accounting is beside herself! She was contacted by the SOC to tell her that her work credentials were found on the dark web by the threat intel team. We managed to recover some files from her machine and sent them to the our REM analyst.\\n\\n\x3c!-- truncate --\x3e\\n\\n## The Files\\n\\nFor this Sherlock we are provided with a zip file that contains some image files taken the users computer, the malicious file in a zip file, and a text file named, keylog.txt.\\n\\n![File List](img/Loggy%20_HTB-Sherlocks_-1741804463466.webp)\\n\\nThe `danger.txt` file just has some warnings about the malicious windows executable in `danger.zip`. I went ahead and extracted the malicious file onto my Kali Linux VM and took a look at the first task in the Sherlock.\\n\\n## Task 1\\n\\n**What is the SHA-256 hash of this malware binary?**\\n\\nMakes sense that the first objective would be to get the hash of the file. The SHA-256 hash can be used along with [VirusTotal](https://virustotal.com/) to check and see if the file matches with any other known malware samples.\\n\\nI went ahead and obtained the SHA-256 hash via using the `sha256sum` cli utility, already preinstalled on the Kali Linux VM.\\n\\n![FIle Hash](img/Loggy%20_HTB-Sherlocks_-1741804778740.webp)\\n\\nAs you can see from the screenshot above the SHA-256 hash of the malicious file, Loggy.exe is **`6acd8a362def62034cbd011e6632ba5120196e2011c83dc6045fcb28b590457c`**.\\n\\n![Task 1 Flag](img/Loggy%20_HTB-Sherlocks_-1741957189991.webp)\\n\\n## Task 2\\n\\n**What programming language (and version) is this malware written in?**\\n\\nHmm, okay for this I attempted to use the `strings` utility. The output from running the strings command without any flags/options produced a large number of results. To target this a little more I decided to make use of the `-n` flag which tells `strings` to return only strings of a specific length. I ran the command `strings -n 6 loggy.exe` and took a look at the results.\\n\\n![Task 2 String Output 01](img/Loggy%20_HTB-Sherlocks_-1741807341782.webp)\\n\\nAs you can see we have a string found in the file stating  `Go Build ID:....`. It looks like this piece of malware may have been written in Golang. I proceeded to run `strings` again, this time using `grep` to filter for `golang`. This also produced a large list of strings that had `golang` contained in them.\\n\\n![Task 2 String Output 02](img/Loggy%20_HTB-Sherlocks_-1741812910090.webp)\\n\\nThe most notable string found was the one highlighted above. Looks like the malware has a dependency for Golang v0.11.0. I attempted to input this as the task flag but, it was not correct.\\n\\n### Golang Research\\n\\nAt this point I started to research how Golang is installed on Windows environments. What are the folder paths where the current versions of Golang are installed? Would they be referenced by the malicious software and show up as a string? Only one way to find out. I found [this page](https://go.dev/doc/manage-install), which details how to manage multiple versions of Golang on a system.\\n\\nI found this line interesting, `go install golang.org/dl/go1.10.7@latest`. It looks like Golang versions are referenced in the `go1.xx.xx` format. We can use this with grep to filter for strings that may contain the version information.\\n\\nRunning the strings utility with grep looking for `go1`, the results returned are of a smaller size and we now know the version of Golang used by the malware, **`go1.22.3`** and the flag of which being **Golang 1.22.3**.\\n\\n![Task 2 String Ouptut 03](img/Loggy%20_HTB-Sherlocks_-1741813507088.webp)\\n\\n![Task 2 Flag](img/Loggy%20_HTB-Sherlocks_-1741957162021.webp)\\n\\n## Task 3\\n\\n**There are multiple GitHub repos referenced in the static strings. Which GitHub repo would most likely suggest the ability of this malware to exfiltrate data?**\\n\\nSo, we need to look at the GitHub repos that are showing up as strings in our malware sample. While I was scrolling through the strings output during the first tasks, I did see a long list of repos that the malware had in its code. Most likely these are used either to download or upload data for malicious functions.\\n\\nFirst command I used to filter for repos was the following.\\n\\n```bash\\nstrings loggy.exe | grep github\\n```\\n\\nLooking at the results, I found some strings that included the url `github.com/jlaffaye/ftp` followed by `*(ServerConn)`, and in some strings `*(dialOptions)`.\\n\\n![Task 3 Strings Ouptput 01](img/Loggy%20_HTB-Sherlocks_-1741956566130.webp)\\n\\nI did a google search for the `golang *(ServerConn)` and got the following.\\n>In Go\'s `net/http` package, `*(ServerConn)` represents a pointer to the `ServerConn` type. This type is an unexported struct responsible for managing the state of a single client connection on the server-side. It handles tasks such as reading requests, writing responses, and managing the connection\'s lifecycle.\\n\\nIt\'s a function in one of the Golang packages that is able to establish and maintain connections. This coupled with the url **`github.com/jlaffaye/ftp`**, indicates that the malware is attempting connections to a remote location which facilitates *data exfiltration*.\\n\\n![Task 3 Flag](img/Loggy%20_HTB-Sherlocks_-1741957044675.webp)\\n\\n## Task 4\\n\\n**What dependency, expressed as a GitHub repo, supports Janice\u2019s assertion that she thought she downloaded something that can just take screenshots?**\\n\\nThe answer to this task, I actually saw in looking for the answer to task 3. There were some GitHub repo strings that referenced `github.com/kbinani/screenshot/internal/util.CreateImage`. Let\'s use a grep filter and search for strings that contain `screenshot` and take a look.\\n\\n```bash\\nstrings loggy.exe | grep github | grep screenshot\\n```\\n\\nI got the following output confirming the usage of `github.com/kbinani/screenshot`.\\n\\n![Task 4 String Output 01](img/Loggy%20_HTB-Sherlocks_-1741957606261.webp)\\n\\nLooking at the Github repo website it explains that it hosts a library that provides *screenshot* functionality in Golang.\\n\\n![Task 4 Github Repo](img/Loggy%20_HTB-Sherlocks_-1742478276466.webp)\\n\\n![Task 4 Flag](img/Loggy%20_HTB-Sherlocks_-1741957661565.webp)\\n\\n## Task 5\\n\\n**Which function call suggests that the malware produces a file after execution?**\\n\\nFor this task I started off with doing some research on Golang and how it calls functions, leveraging the knowledge that the malware was written in Golang. In most programming languages the syntax for creating a file is normally `write` and may include the word `file`.  I filtered the strings output with the command below:\\n\\n```bash\\nstrings loggy.exe | grep -i write | grep -i file\\n```\\n\\n![Task 5 Strings Output 01](img/Loggy%20_HTB-Sherlocks_-1741959647247.webp)\\n\\nLooking at the tail end of the output, we can see a few function calls that have `WriteFile` as a part of them but, there is also a standalone string `WriteFile`, this looked to be the function call we are looking for. I entered it in the flag box and it was the answer.\\n\\n![Task 5 Flag](img/Loggy%20_HTB-Sherlocks_-1741959977351.webp)\\n\\n## Task 6\\n\\n**You observe that the malware is exfiltrating data over FTP. What is the domain it is exfiltrating data to?**\\n\\nThe task is pretty straight forward, we need to find the hostname that the FTP function is connecting to and exfiltrating data/images to. I attempted to use grep to filter for a few keywords which included, hostname, IP, target, and address. I started to get the feeling that I was missing something. Looking at what the task asks of you for, we know that the malware is making use of the FTP protocol. The protocol uses the ports 21 and 20. Port 21 being for command/control and port 20 for data transfer. I proceeded to filter the output of the strings command, looking for both ports. Normally when a port is referenced along with an ip or hostname there is a `:`, between the address and the port like `192.168.1.189:21` or `192.168.1.189:20`. I ran the command below, looking for any strings containing `:21`and found the following:\\n\\n```bash\\nstrings Loggy.exe | grep :21\\n```\\n\\n![Task 6 Strings Output](img/Loggy%20_HTB-Sherlocks_-1742241362516.webp)\\n\\nWe are returned a string that contains `gotthem.htb:21`. The domain being **`gotthem.htb`**.\\n\\n![Task 6 Flag](img/Loggy%20_HTB-Sherlocks_-1742241541273.webp)\\n\\n## Task 7\\n\\n**What are the threat actor\u2019s credentials?**\\n\\nOkay so for this task I attempted to filter for keywords like username, password, pwd, user, usr, etc, but I did not find anything of note. For the next phase of analysis, I went ahead and moved to a Windows VM to use reverse engineering software to complete a deeper analysis.\\n\\nThe Windows VM that I am working in was setup using FlareVM, a really handy tool for creating a malware analysis/reverse engineering platform for investigations. If you want to read more about FlareVM and how to set it up proceed over [here](https://github.com/mandiant/flare-vm) to the official GitHub page.\\n\\nHere we are in our FlareVM ready to go.\\n\\n![Task 7 FlareVM](img/Loggy%20_HTB-Sherlocks_-1742313434776.webp)\\n\\nLets now check for the presence of credentials in the malware\'s assembly code. For this task I am making use of a tool called Ghidra, which was created and used by the NSA as a reverse engineering framework.\\n\\nI proceeded to make a new project and import our malware sample `loggy.exe`. Taking a look a the symbol tree we can see a list of functions that have been auto-named by Ghidra. You can see a host of functions related to FTP functionality, which we know is how the malware is exfiltrating data.\\n\\nDigging into the functions and their logic, I was able to find a function, `main.sendFilesViaFTP` that referenced the credentials that the malware was using for it\'s FTP communications, username:`NottaHacker` & password: `Cle@rtextP@ssword`.\\n\\n![Task 7 Ghidra](img/Loggy%20_HTB-Sherlocks_-1742330029922.webp)\\n\\n![Task 7 Flag](img/Loggy%20_HTB-Sherlocks_-1742330574338.webp)\\n\\n## Task 8\\n\\n**What file keeps getting written to disk?**\\n\\nPretty straight  forward question. Lets dive into the disassembled code to get a look at what the malware is writing to the disk. We should also note that the malware sample was provided along with some screenshots what looks to be a keylogger dump file named `keylog.txt`, so these filenames could be an easy entry point to confirm what files are constantly being written.\\n\\nDiving back into Ghidra I started my search/investigation from the vantage point of the `keylog.txt` file. Looking at the contents of the file it looks like the malware is logging keycodes to this file. In theory, if the malware is indeed logging keystrokes as keycodes to this file, then the malware will have to constantly and continuously write to this file many times over.\\n\\n![Task 8 Keylog Text](img/Loggy%20_HTB-Sherlocks_-1742390061413.webp)\\n\\nWith this hypothesis in mind I searched for defined strings that contained the filename of `keylog.txt` and got some hits.\\n\\n![Task 8 Ghidra 01](img/Loggy%20_HTB-Sherlocks_-1742389970110.webp)\\n\\nThe above image shows that the auto named variable `s_keylog.txt_00650309` is storing the string value of `keylog.txt` the variable is also referenced by some functions as well. We can double-click on these functions and follow their execution to discern behavior/actions.\\n\\nFollowing on and checking the top function, `main.main:005f325e`, I can see that the variable is accessed and it looks like an OS function is invoked for opening and accessing the file.\\n\\n![Task 8 Ghidra 02](img/Loggy%20_HTB-Sherlocks_-1742390524507.webp)\\n\\nFurther down the function we can also see what looks to be some error handling logic, in case the malware can not access/write to the `keylog.txt` file. Looks like we might be on the correct path to the answer.\\n\\n![Task 8 Ghidra 03](img/Loggy%20_HTB-Sherlocks_-1742390643440.webp)\\n\\nChecking the other two functions `main.sendFilesViaFTP:005f3c64(*)` & `main.sendFilesViaFTP:005f3d91(*)`. They also reference the `keylog.txt` string, before invoking FTP functions, facilitating data exfiltration.\\n\\n![Task 8 Ghidra 04](img/Loggy%20_HTB-Sherlocks_-1742391020772.webp)\\n\\n![Task 8 Ghidra 05](img/Loggy%20_HTB-Sherlocks_-1742391054743.webp)\\n\\n![Task 8 Ghidra 06](img/Loggy%20_HTB-Sherlocks_-1742391077761.webp)\\n\\nSo, with all of this collected data and insight, I went ahead and input `keylog.txt` as the answer to the flag, which was correct.\\n\\n![Task 8 Flag](img/Loggy%20_HTB-Sherlocks_-1742391181533.webp)\\n\\n## Task 9\\n\\n**When Janice changed her password, this was captured in a file. What is Janice\'s username and password?**\\n\\nAlright so from the previous task we know that the malware is logging keystrokes to the `keylog.txt` file. We also know that there are keycodes and characters present in the file as well.\\n\\nI did some searching around for a tool to convert keycodes to characters but, could not find a tool that fit my needs. This is where I turned to ChatGPT to analyze the contents of the `keylog.txt` file and provide some insights/results.\\n\\n![Task 9 ChatGPT](img/Loggy%20_HTB-Sherlocks_-1742391408637.webp)\\n\\nChatGPT provided a nice break down and explanation of the keycodes and their value. It also provided translations of the keycodes, providing text we can use to discern the password logged.\\n\\nWe know that the user\'s name is `Janice` but, there are a few options presented for her password, `PASSWORD`, `PAAAASASSASSSSSWWWWOOOOORRRRDDDD`, `PASSWORD123`, and `PASSWORD.TTTTTXXXXXTTTTT`. The correct combination being `janice:password123`.\\n\\n![Task 9 Flag](img/Loggy%20_HTB-Sherlocks_-1742391749137.webp)\\n\\n## Task 10\\n\\n**What app did Janice have open the last time she ran the \\"screenshot app\\"?**\\n\\nThis task is straightforward. Included in the zip file for the sherlock is a series of 4 image files. Looking at the sequence of images we can see that the user had the `Solitaire` app open the last time she ran the malware.\\n\\n![Task 10 Screenshot 01](img/Loggy%20_HTB-Sherlocks_-1742393597149.webp)\\n\\n![Task 10 Screenshot 02](img/Loggy%20_HTB-Sherlocks_-1742393785045.webp)\\n\\n![Task 10 Screenshot 03](img/Loggy%20_HTB-Sherlocks_-1742394045621.webp)\\n\\n## Key Takeaways\\n\\n- [FlareVM](https://github.com/mandiant/flare-vm) is a really good resource for setting up reverse engineering machines. With its comprehensive list of tools and utilities it makes the task of reverse engineering & malware analysis that much more easy.\\n- `strings` & `grep` can be useful in passive analysis of malware. When used in conjunction they allow for filtering and gathering information about said malware. This facilitates deeper investigation and understanding of malware behavior.\\n- [Ghidra](https://github.com/NationalSecurityAgency/ghidra) is a reverse engineering framework developed by the NSA. It provides much of the same functionality as another popular tool [IDA](https://hex-rays.com/) , decompiling of Windows Portable Executable files, the ability to see function logic and defined variables, etc. Ghidra is also open-source compared to IDA which is proprietary and has a pro version."},{"id":"NetTrafficAnalysis","metadata":{"permalink":"/blog/NetTrafficAnalysis","source":"@site/blog/2025-02-03-NetTrafficAnalysis/index.md","title":"What I\'ve Learned - Network Traffic Analysis","description":"Lessons learned from analyzing network traffic with Wireshark and tcpdump.","date":"2025-02-03T00:00:00.000Z","tags":[{"inline":true,"label":"NetworkTrafficAnalysis","permalink":"/blog/tags/network-traffic-analysis"},{"inline":true,"label":"Detection","permalink":"/blog/tags/detection"},{"inline":true,"label":"Wireshark","permalink":"/blog/tags/wireshark"},{"inline":true,"label":"tcpdump","permalink":"/blog/tags/tcpdump"}],"readingTime":5.01,"hasTruncateMarker":true,"authors":[{"name":"Dario Cruz","title":"Maintainer of DarioCruz.dev","url":"https://github.com/dario-cruz","imageURL":"https://github.com/dario-cruz.png","key":"dcruz","page":null}],"frontMatter":{"slug":"NetTrafficAnalysis","title":"What I\'ve Learned - Network Traffic Analysis","description":"Lessons learned from analyzing network traffic with Wireshark and tcpdump.","keywords":["network traffic analysis","Wireshark","tcpdump","detection","cybersecurity"],"image":"/img/itsmedario.webp","authors":["dcruz"],"tags":["NetworkTrafficAnalysis","Detection","Wireshark","tcpdump"],"enableComments":true},"unlisted":false,"prevItem":{"title":"Loggy (HTB-Sherlock)","permalink":"/blog/Loggy-Sherlock"},"nextItem":{"title":"Kerberoasting: What You Need To Know","permalink":"/blog/Kerberoasting-Explained"}},"content":"![Network Traffic Detective](img/Net%20Traffic%20Detective.png)\\r\\nI recently completed the Hack The Box module: [Intro to Network Traffic Analysis](https://academy.hackthebox.com/achievement/379578/229). I have to say I really enjoyed this module as we dived into the Analysis process. The whole module gave me the feeling of being a private investigator/detective, digging through tons of information to look for anomalies or patterns that indicate compromise or a security event. Lets dig into what I learned over the course of the module and how it can be applied in practice.\\r\\n\\r\\n\x3c!-- truncate --\x3e\\r\\n\\r\\n## Why is Network Traffic Analysis Important?\\r\\n\\r\\nThis is a good question to pose as we need to establish the intent and need for Network Traffic Analysis.\\r\\n\\r\\nNetwork Traffic Analysis, can be defined as inspecting of network traffic patterns, analysis network protocol behavior, and analyzing network packets for abnormal behavior, or indicators of compromise.\\r\\n\\r\\nWhen you think about it networks are the core of IT infrastructure. Without a network, computers and servers providing services can not communicate with one another. This need for communication is the very reason computers are interconnected in the first place. Threat actors know that communication is paramount to organizations and individuals and by association, the work that they do. Threat actors use this fact and exploit a given network for various reasons.\\r\\n\\r\\n- To disrupt service and functionality\\r\\n- To capture and exfiltrate data.\\r\\n- To gain unauthorized access to a network or service.\\r\\n\\r\\nRegular checking and investigation of network traffic is important as many times abnormal network communication is the first indicator that something malicious has or will take place.\\r\\n\\r\\nCiting the NIST publication [Network Security Traffic Analysis Platform - Design and Validation](https://www.nist.gov/publications/network-security-traffic-analysis-platform-design-and-validation), it states:\\r\\n> Real-time traffic management and control have become necessary in today\'s networks due to their complexity and cybersecurity risks. With the increase in internet use, threats are more present and require real-time detection and analysis to prevent intrusions. As the number of data flows increases, the number and the types of attacks increase, which makes detecting intrusions challenging. Over the last years, many researchers have focused on different ways to detect intrusions in different systems. In this work, we describe the design and evaluation of a network security traffic analysis platform (NSTAP) to collect, view, search and analyze traffic data in real-time. Through charts, tables, histograms and other visualization methods, we demonstrate its power and usefulness with results obtained with simple time analytics of large data volumes. This work is intended to be the foundation for machine learning based automation tools.\\r\\n\\r\\n## What is the Process?\\r\\n\\r\\nThe process of analyzing network traffic is cyclical. The higher level process steps inform the bottom level steps and vise versa, information is echoed to each other until the full picture of the threat actors actions come into view.\\r\\n![NTA Process](img/Network%20Traffic%20Analysis%20Process.svg)\\r\\n\\r\\n### Steps of the Cycle\\r\\n\\r\\n- **Monitoring** - The continuous capture of data from the network using tools like *Tcpdump*, *Wireshark*, or a *SIEM* platform.\\r\\n- **Analysis** - Reviewing of data captured. Looking for anomalies, patterns, and threats.\\r\\n- **Action** - Implementing changes in an effort to remediate the issue and harden the given network, servers/services, and hosts from future attack.\\r\\n- **Documentation and Review** - Logtargetteds and Reports of given incidents are used to assess the current processes around responding to the incident. Things like what tools where used to investigate and also remediate the issue. Could this be streamlined further?\\r\\n- **Adaptation and Improvement** - Lessons learned from the entire cycle, used to create refinements and efficiencies in analyzing and responding to found incidents or events. Drives improvement through out the entire cycle.\\r\\n\\r\\n## Tools Used\\r\\n\\r\\nThe most commonly used tools for Network Traffic Analysis are as follows:\\r\\n\\r\\n- **Wireshark** - GUI based network packet capture and analysis tool. Has a host of features that allow for granular filtering of captured traffic, plugins that include functions for displaying statistics about packets captured, rebuilding of protocol traffic flows, and exporting of transferred data, files, images, etc. *Makes use of BPF syntax for filtering*.\\r\\n- **TShark** - Terminal based version of Wireshark that has many of the same features. Is accessed via the CLI and does not have a GUI. *Also uses BPF Syntax for filtering.*\\r\\n- **Tcpdump** - Terminal based packet sniffer/capture and analysis tool for Unix based systems. Has a host of features that are accessed via `flags` that are used to define whether to read or write a packet capture file, and how to filter the file and display the output.\\r\\n\\r\\n### BPF Syntax\\r\\n\\r\\nStands for [Berkeley Packet Filter Syntax](https://www.ibm.com/docs/en/qsip/7.4?topic=queries-berkeley-packet-filters) and was created by two individuals, Steven McCanne and Van Jacobson, while they were at Berkeley College\'s Lawrence Laboratory. [^1] The syntax is widely used in packet capture and filtering tools due to it\'s ability to quickly reduce packet captures to targeted results. [^2]\\r\\n\\r\\n[^1]: [https://en.wikipedia.org/wiki/Berkeley_Packet_Filter](https://en.wikipedia.org/wiki/Berkeley_Packet_Filter)\\r\\n[^2]: [https://www.ibm.com/docs/en/qsip/7.4?topic=queries-berkeley-packet-filters](https://www.ibm.com/docs/en/qsip/7.4?topic=queries-berkeley-packet-filters)\\r\\n\\r\\n## Detection and Threat Hunting\\r\\n\\r\\nNetwork Traffic Analysis and be used for detection of malicious activity on a given network but, in the case that their is no SIEM or IDS/IPS system running on the network. Network Traffic Analysis can be used to *hunt for threats*. Through the use of packet analysis, looking for odd connections to or from hosts, looking at large amounts of data being transferred over a network during non-work hours could be indicators of malicious activity.\\r\\n\\r\\n## Wireshark File Extraction\\r\\n\\r\\nWireshark has the ability to follow traffic flows and rebuild data that has been transferred to completion, over a given network. This specific functionality is called the *dissector*, which will reassemble the data into the original file. This allows for complete files to be analyzed or read in isolated environments, providing more insight as to what is actually taking place.\\r\\n[^3]\\r\\n[^3]: [https://www.wireshark.org/docs/wsug_html_chunked/ChIOExportSection.html](https://www.wireshark.org/docs/wsug_html_chunked/ChIOExportSection.html)"},{"id":"Kerberoasting-Explained","metadata":{"permalink":"/blog/Kerberoasting-Explained","source":"@site/blog/2024-12-5-Kerberoasting/index.mdx","title":"Kerberoasting: What You Need To Know","description":"Kerberoasting explained with Kerberos basics, attack flow, and defensive insights.","date":"2024-12-05T00:00:00.000Z","tags":[{"inline":true,"label":"Kerberos","permalink":"/blog/tags/kerberos"},{"inline":true,"label":"Kerberoasting","permalink":"/blog/tags/kerberoasting"},{"inline":true,"label":"Active-Directory","permalink":"/blog/tags/active-directory"},{"inline":true,"label":"Rubeus","permalink":"/blog/tags/rubeus"},{"inline":true,"label":"Hashcat","permalink":"/blog/tags/hashcat"}],"readingTime":7.74,"hasTruncateMarker":true,"authors":[{"name":"Dario Cruz","title":"Maintainer of DarioCruz.dev","url":"https://github.com/dario-cruz","imageURL":"https://github.com/dario-cruz.png","key":"dcruz","page":null}],"frontMatter":{"slug":"Kerberoasting-Explained","title":"Kerberoasting: What You Need To Know","description":"Kerberoasting explained with Kerberos basics, attack flow, and defensive insights.","keywords":["Kerberoasting","Kerberos","Active Directory","Rubeus","Hashcat"],"image":"/img/itsmedario.webp","authors":["dcruz"],"tags":["Kerberos","Kerberoasting","Active-Directory","Rubeus","Hashcat"],"enableComments":true},"unlisted":false,"prevItem":{"title":"What I\'ve Learned - Network Traffic Analysis","permalink":"/blog/NetTrafficAnalysis"},"nextItem":{"title":"RogueOne (HTB-Sherlocks)","permalink":"/blog/RogueOne-HTB-Sherlocks"}},"content":"![Kerberoasting](img/4bb6b8a0a373ae8196887b8c953a9127.png)\\r\\nHello Everyone! \ud83d\udc4b\\r\\n\\r\\nToday we will be learning about Kerberoasting, an attack that targets Kerberos. I decided to write an article about this topic as I am actively learning about the attack as a part of the Hack the Box CDSA certification.\\r\\n\\r\\nTo first understand what Kerberoasting is, we need to dive into Kerberos, what is is, what it offers, and how it works to gain better insight into how Kerberoasting are carried out, and why threat actors persistently choose this method to gain access to AD environments.\\r\\n\x3c!-- truncate --\x3e\\r\\n\\r\\n## Kerberos... What\'s that?\\r\\nKerberos is a network authentication mechanism that is used in Active Directory and other systems/environments. It was developed by Massachusetts Institute of Technology(MIT) in the last 1980\'s and is now the default authorization technology in Microsoft Windows, it has also been implemented in Apple OS, FreeBSD, UNIX, and Linux. Active Directory its self has the largest market share out of all IAM platforms so attackers target AD environments and attack Kerberos consistently, thus this is a good topic to learn about.  [^1] \\r\\n\\r\\nThe main reason the protocol was developed in the first place, was to provide a way of securing authentication traffic on a given network, preventing threat actors from intercepting authentication transmissions, gaining unauthorized access. Back in the 1980\'s most authentication was transmitted in clear text over networks, making it easy for threat actors with network access to eavesdrop on traffic and obtain credentials.[^2]\\r\\n\\r\\n[^1]: https://www.simplilearn.com/what-is-kerberos-article#:~:text=This%20process%20uses%20shared%20secret,against%20eavesdropping%20and%20replay%20attacks.\\r\\n[^2]: https://www.techtarget.com/searchsecurity/definition/Kerberos\\r\\n### Components\\r\\nKerberos consists of a few interconnected parts that work together to offer a complete & secure authentication and authorization protocol.\\r\\n- **The Client**: The end point that is requesting authentication to an app, service, or network. The client will send out a request to what is called the *Key Distribution Center*, with it\'s encrypted credentials and await a response back.\\r\\n- **Key Distribution Center**: Handles the requests from clients for authentication, is comprised of 3 elements, which all tend to reside on the same server. They are the *Authentication Server*, *Ticket Granting Server*, and a *Database*. \\r\\n\\t- **Authentication Server**: Component of the KDC that receives client requests and provides successfully authenticated clients with a ticket known as a *Ticket Granting Ticket (TGT)*. The TGT allows for authed clients to obtain other *Service Tickets* without having to re-enter credentials. \\r\\n\\t- **Ticket Granting Server (TGS)**: Component of the KDC that is the distributor of *Service Tickets* to clients with a valid *TGT*, providing them access to specific services, apps, or networks. \\r\\n\\t- **Database**: Part of the KDC that contains entries of *users* and the associated *services* that they have access to. Also contains information related to the *max validity duration* for a ticket, *max time a ticket may be renewed*, *password expiration date*, etc.\\r\\n\\r\\n![Kerberos Diagram](img/KerberosDiagram.svg)\\r\\n\\r\\n## Kerberoasting\\r\\nOkay so now that we have an understanding of how Kerberos works, we will move on to how threat actors carry out what is called Kerberoasting. \\r\\n\\r\\nKerberoasting is an attack that attempts to obtain the password hash of an Active Directory *Service Account* that has what is called a *Service Principal Name (SPN)*. What is an SPN you might ask? Well, it is a Active Directory attribute that is used by Kerberos authentication mechanisms to associate a service instance with corresponding service account, providing access to said service. [^3] [^4]\\r\\n[^3]: https://www.crowdstrike.com/en-us/cybersecurity-101/cyberattacks/kerberoasting/\\r\\n[^4]: https://learn.microsoft.com/en-us/windows/win32/ad/service-principal-names\\r\\n### The Attack\\r\\nThe threat actor must first gain access to a domain user account via compromise, not a *Domain Admin account*, just a regular account, this then allows them to request a Kerberos service ticket from the TGS. This is done with the use of tools, most commonly [Rubeus](https://github.com/GhostPack/Rubeus). Once the ticket is received from the KDC the threat actor stores the key for offline brute forcing. The ticket from the KDC contains an encrypted hash of the *service accounts* password. \\r\\n\\r\\nRubeus is a tool, written in C# that automates interaction and abuse of Kerberos authentication mechanisms. It has a host of options such as making Ticket Requests and Renewals, Ticket Forgery, Ticket Extraction and Harvesting. [^5] \\r\\n[^5]: https://github.com/GhostPack/Rubeus\\r\\n\\r\\nSo lets say that we wanted to use the tool to carryout our own testing, or make use of it for a capture the flag challenge. On Windows via PowerShell, the command to carry out Kerberoasting, using Rubeus, would be;\\r\\n```Shell\\r\\n.\\\\Rubeus.exe kerberoast /outfile:results.txt\\r\\n```\\r\\n\\r\\nAfter obtaining the SPN values from Rubeus, threat actors then carry out offline brute forcing with tools like Hashcat or JohnTheRipper. In the case of hashcat, looking at the documentation for the command-line utility, there is a specific hash option designed for Kerberos 5 hashes, hash option `13100`. \\r\\n![](img/f35a8e5b76f9bc3c1542c0fddecd383f.png)And if we were to let\'s say use the `result.txt` file form the Rubeus output, you could use the below command to crack the hashes of the returned SPN\'s.\\r\\n```bash\\r\\nhashcat -m 13100 -a 0 wordlist.txt results.txt --outfile=\\"cracked-spns.txt\\"\\r\\n```\\r\\nThe `-m` flag  allows for specifying what hash type we would like to crack, and as stated previously `13100` is the value for the Kerberos hash type. The`-a` flag specifies the type of attack mode to use. It\'s followed by the value of `0` which is \\"Straight Mode\\". Straight Mode uses a single wordlist, as you can see by flag and value having `wordlist.txt` specified after it. Next is the target file that contains the hash, in our case it is `results.txt`. At the end we have `--outfile` which directs hashcat to save the output to a specified file, in this case `cracked-spns.txt`, formatting can also be changed for the output file via `--outfile-format` as well. [^6]\\r\\n[^6]: https://hashcat.net/wiki/\\r\\n### Attack Chain Visualized\\r\\nBelow I have included a graphic of the entire Kerberoasting attack chain.\\r\\n\\r\\n![KerberosAttackChain](img/KerberosAttackChain.svg)\\r\\n\\r\\n### Detection\\r\\nKerberoasting attacks can be detected via the monitoring of **Windows Event Code: 4769**, which is the Windows event code that corresponds to a Kerberos ticket being requested. In the logs for this event code there are a few fields to take not of, specifically the *Account Name*, *Service Name*, *Client Address*, and the *Ticket Encryption Type*. The value for the *Ticket Encryption Type* is an important, the hex values represent the type of encryption being used for the request and could tip us off to a potential attack. \\r\\n\\r\\nBelow is a table of common encryption types and their strengths.\\r\\n\\r\\n| Hex code | Encryption Type         | Description                                                                                   |\\r\\n| -------- | ----------------------- | --------------------------------------------------------------------------------------------- |\\r\\n| 0x17     | RC4_HMAC                | **Weak Encryption, Commonly Used for Kerberoasting attacks**                                  |\\r\\n| 0x12     | AES256_CTS_HMAC_SHA1_96 | Strong encryption, preferred for modern environments.                                         |\\r\\n| 0x11     | AES128_CTS_HMAC_SHA1_96 | Strong but less secure then AES256.                                                           |\\r\\n| 0x01     | DES_CBC_CRC             | Deprecated/Weak encryption.                                                                   |\\r\\n| 0x02     | DES_CBC_MD5             | Deprecated/Weak encryption.                                                                   |\\r\\n| 0x03     | DES3_CBC_SHA1           | Stronger then both DES encryption algorithms but is not commonly used in modern environments. |\\r\\n\\r\\nTake note that any Kerberos request that uses the `RC4_HMAC` encryption protocol is potentially an indicator of attack or compromise. \\r\\n\\r\\nAlso, we need to note that if any of the legacy encryption methods are left enabled on the KDC server, attackers could carryout a downgrade attack on the Kerberos system, effectively forcing the authentication/authorization protocol to use a weaker level encryption allowing for threat actors to more easily crack the SPN hash. \ud83d\ude2c\\r\\n\\r\\nLets say that we wanted to do an SPL query in Splunk for Kerberoasting, targeting the Event 4769 and the Ticket Encryption Value of 0x17, the query would look like this:\\r\\n```SPL\\r\\nindex=<target-index> EventCode=4769 EncryptionType=0x17\\r\\n```\\r\\n\\r\\n### Prevention\\r\\nThe goal of Kerberoasting attacks is the theft of service account credentials and the eventual compromise of the AD Doman, allowing threat actors to gain a foot hold in an organizations environment and carry out further malicious actions. Due to these factors, prevention of Kerberoasting attacks should take a multi-faceted approach. Below are some methods to protect against Kerberoasting attacks:\\r\\n- Use of strong & complex Service Account passwords & the updating of said passwords on a regular cadence. [^7]\\r\\n- Restriction of Service Principal Name (SPN) Exposure via limiting SPN registration and using Managed Service Accounts. [^8] \\r\\n- Enforcement of strong encryption types, threat actors will attempt to push the protocol to downgrade the encryption, if these lower level encryption standards are enabled, the domain will be left vulnerable to Kerberoasting attacks. [^8]\\r\\n- Implementing Monitoring and Auditing of Kerberos Ticket Requests, this will allow for alerting on unusual requests and audits will find unusual patterns that could indicate attack or compromise. [^9]\\r\\n\\r\\n## Conclusion\\r\\nAnd with that, you know have a pretty good understanding of Kerberos & Kerberoasting. How threat actor target Kerberos and Active Directory in an attempt to compromise a Service Account, and potentially over parts of the domain after the initial compromise. \\r\\n\\r\\nYou also know now how to detect and defend from these types of attacks but, there is always more to learn and more to dig into and understand. As my learning progresses I will update this article with other bits of information I find related to Kerberoasting.\\r\\n\\r\\n**Thank you for reading! \ud83d\ude0e**\\r\\n\\r\\n[^7]: https://www.semperis.com/blog/protecting-active-directory-from-kerberoasting/\\r\\n[^8]: https://www.microsoft.com/en-us/security/blog/2024/10/11/microsofts-guidance-to-help-mitigate-kerberoasting/\\r\\n[^9]: https://cymulate.com/cybersecurity-glossary/kerberoasting/"},{"id":"RogueOne-HTB-Sherlocks","metadata":{"permalink":"/blog/RogueOne-HTB-Sherlocks","source":"@site/blog/2024-11-18-RogueOne-Sherlock/index.mdx","title":"RogueOne (HTB-Sherlocks)","description":"HTB Sherlock RogueOne investigation focused on memory forensics and C2 analysis.","date":"2024-11-18T00:00:00.000Z","tags":[{"inline":true,"label":"Hackthebox","permalink":"/blog/tags/hackthebox"},{"inline":true,"label":"Labs","permalink":"/blog/tags/labs"},{"inline":true,"label":"Incident-Response","permalink":"/blog/tags/incident-response"},{"inline":true,"label":"Volatility","permalink":"/blog/tags/volatility"},{"inline":true,"label":"Hashing","permalink":"/blog/tags/hashing"},{"inline":true,"label":"Virustotal","permalink":"/blog/tags/virustotal"},{"inline":true,"label":"Memory-Forensics","permalink":"/blog/tags/memory-forensics"},{"inline":true,"label":"Python","permalink":"/blog/tags/python"}],"readingTime":13.62,"hasTruncateMarker":true,"authors":[{"name":"Dario Cruz","title":"Maintainer of DarioCruz.dev","url":"https://github.com/dario-cruz","imageURL":"https://github.com/dario-cruz.png","key":"dcruz","page":null}],"frontMatter":{"slug":"RogueOne-HTB-Sherlocks","title":"RogueOne (HTB-Sherlocks)","description":"HTB Sherlock RogueOne investigation focused on memory forensics and C2 analysis.","keywords":["Hack The Box","Sherlock","RogueOne","memory forensics","Volatility"],"image":"/img/itsmedario.webp","authors":["dcruz"],"tags":["Hackthebox","Labs","Incident-Response","Volatility","Hashing","Virustotal","Memory-Forensics","Python"],"enableComments":true},"unlisted":false,"prevItem":{"title":"Kerberoasting: What You Need To Know","permalink":"/blog/Kerberoasting-Explained"},"nextItem":{"title":"Noxious (HTB-Sherlocks)","permalink":"/blog/Noxious-HTB-Sherlocks"}},"content":"![RogueOne](img/b7497376cdde03305e1abce7fddc155c.png)\\r\\nIt\'s that time again, lets dig into another investigation, this time it looks like we will be digging into memory forensics. \ud83d\udd75\ufe0f\u200d\u2642\ufe0f\ud83e\udd13\ud83d\udd0e\\r\\n\x3c!-- truncate --\x3e\\r\\n## Scenario\\r\\n>Your SIEM system generated multiple alerts in less than a minute, indicating potential C2 communication from Simon Stark\'s workstation. Despite Simon not noticing anything unusual, the IT team had him share screenshots of his task manager to check for any unusual processes. No suspicious processes were found, yet alerts about C2 communications persisted. The SOC manager then directed the immediate containment of the workstation and a memory dump for analysis. As a memory forensics expert, you are tasked with assisting the SOC team at Forela to investigate and resolve this urgent incident.\\r\\n### What are C2 communications\\r\\nThis term is new to me, so time to do some research to gain more context into the event. After doing some googling I found that C2 just stands for **Command & Control**, meaning that the computer is potentially compromised and could be part of a botnet. Yikes!\ud83d\ude2c\\r\\n### The Provided Files\\r\\nFor this investigation the zip file is 1gig in size. Looks like we will be sifting through a lot of data. The file stored inside of the zip file is a `.mem` file, which I have not used before but, makes sense as in the given scenario, it\'s stated that a memory dump is provided for analysis. \\r\\n### Memory Analysis Software (Volatility)\\r\\nI looked into the different types of software used by SOC teams, to analyze `.mem` files and I came across **[Volatility Framework](https://volatilityfoundation.org/)**, an open-source tool that is used for memory forensics. I went ahead and followed the instructions on the [github page](https://github.com/volatilityfoundation/volatility3) for installing the needed dependencies(python3) and Volatility 3 on a Linux VM.\\r\\n![](img/1c6cfe1f2b558f44b8954e21d9026899.png)\\r\\nI also needed to create a python virtual environment for use for volatility. Python virtual environments are used to isolate dependencies for projects, instead of installing dependencies globally, which is messy and could cause issues down the road. I went ahead and attempted to create and environment using the following command:\\r\\n```bash\\r\\npython3 -m venv venv\\r\\n```\\r\\nI was met with the following message that I did not have the needed package installed, `python3.12-venv`. \\r\\n![](img/c33f60c71254c640e86a1eedeb33c673.png)\\r\\nI used the command provided along with `sudo` to install the needed package. \\r\\n```bash\\r\\nsudo apt install python3.12-venv -y\\r\\n```\\r\\nNow we need to activate the python environment via the following command. \\r\\n```bash\\r\\nsource venv/bin/active\\r\\n```\\r\\nOur virtual python environment should now be active, you can observe this via the terminal output, which now includes `(venv)`.\\r\\n\\r\\n![](img/9b88a37ccd953430bd050a39b6eca3d5.png)\\r\\nAnd finally, as you can see from the image above, we can now run volatility commands.\\r\\n## Task 1 & 2\\r\\n1. **Please identify the malicious process and confirm process id of malicious process.**\\r\\n2. **The SOC team believe the malicious process may spawned another process which enabled threat actor to execute commands. What is the process ID of that child process?**\\r\\n\\r\\nSo now that we have volatility3 installed and running we can run commands to accomplish various functions. Doing `python vol.py -h` brings up the following output. \\r\\n![](img/44510b5da4eace402c27bfcc93173016.png)\\r\\nWhich provides a useful list of flags, arguments and parameters that can be used with the command line utility. The flag, `-f` allows for specifying of a file to process and analyze, this then must be followed with a value for the plugin to be used on the file. In the case of this question we need to look at the processes that were running on the machine at the time the SOC team was alerted and captured a memory dump of the affected machine. Looking at the list of plugins available from the fresh install, I can see that there is a plugin called `windows.pslist`, which allows listing of processes that are present in the target windows memory image.\\r\\n![](img/03ead33c7fa77ae3df2af272b2ce1a7b.png)\\r\\nSo now we craft the final command to get the processes, we call python to run `vol.py`, adding the `-f` flag and specifying the target file which is, in my case located on an attached folder share to the VM. File path to the memory dump we need to analyze for this lab is `/media/sf_D_DRIVE/HTB-Sherlocks/RogueOne/20230810.mem`. Then we envoke the plugin we need, so that we can get the intended output, `windows.pslist`. \\r\\nThe final command:\\r\\n```bash\\r\\npython vol.py -f /media/sf_D_DRIVE/HTB-Sherlocks/RogueOne/20230810.mem windows.pslist\\r\\n```\\r\\n\\r\\nRunning the command gives us a list of all of the processes, that of which there are many.\\r\\n![](img/f73d3623f999398cba988e8e108c8f17.png)\\r\\n\\r\\nI went ahead and ran the program again by this time piping the output to a text file that could be searched through and analyzes in greater detail. \\r\\n```bash\\r\\npython vol.py -f /media/sf_D_DRIVE/HTB-Sherlocks/RogueOne/20230810.mem windows.pslist > pslist_output.txt\\r\\n```\\r\\nAfter running the above command we can now use the `cat` and `grep` command line utilities to display and filter the content contained within the created text file. \\r\\n![](img/93dab0d3f29187c9af4bbcd192fba855.png)\\r\\n### Investigating the Output\\r\\nLooking through the list of processes there are no processes that are named suspiciously at first glance. We do have two *Process ID (PID)* rows though, one for regular PID values and a second for a *Parent Process ID (PPID)* which are processes that have been spawned from other running processes. Threat actors may do what is called, ***Living off The Land (LOTL)*** which is a technique that allows threat actors obfuscate there activity and avoid detection via using the software included in the operating system and whatever applications the user has installed that may be vulnerable. \\r\\n\\r\\nTaking all of that into account, if we look toward the bottom of the pslist_output file, we can see two processes for `cmd.exe`, the running of command prompt it\'s self is not a red flag, though normal end-users for the most part will not be launching that application on a regular basis. The red flag in this case are the parent processes that have spawned both instances of `cmd.exe`.  Lets use both the `cat` & `grep` cmd line utilities to filter the `pslist_output.txt` file and gain more insight.\\r\\n\\r\\n![](img/0e1833acfc3625b76a9b214831a82653.png)\\r\\nUsing `cat` to display the output and `grep` to filter for `cmd.exe` we can see that the parent PID\'s, which are `936` & `6812`. Filtering for both of these PIDs brings up two distinct `svchost.exe` processes. \\r\\n![](img/14c8875f85526f3ba123314eaf00b7dc.png)\\r\\n### svchost.exe\\r\\nDigging into the information on the svchost process, I found that it\'s known as the Service Host. It is an integral system process for the Windows Operating system and acts as a host/manager for *DLL-Based* Windows Services. Essentially is manages **background** services allowing the OS to run efficiently. \\r\\n\\r\\nI also found that `svchost.exe` spawning the `cmd.exe` process is not considered to be normal behavior for the process and is a clear indicator of compromise. Also when filtering for all of the `svchost.exe` processes, they all share the same *PPID* except for the `svchost.exe` processes that spawned `cmd.exe`. \\r\\n![](img/e4e62b1fde93578999bc8d15e4a71640.png)\\r\\n### The Answers\\r\\nSo now that we have done our investigation and analysis of the processes that were running at the time of detection, we can answer the questions in both Task 1 and in Task 2.\\r\\n#### Please identify the malicious process and confirm process id of malicious process.\\r\\nThe malicious process in this case is the `svchost.exe (6812)` process that spawned the `cmd.exe (4364)`. Since they ask for the process ID as input, it would be **6812**.\\r\\n#### The SOC team believe the malicious process may spawned another process which enabled threat actor to execute commands. What is the process ID of that child process?\\r\\nThat would be the child process, that `svchost.exe` spawned, the `cmd.exe` process that has a PID of **4364**.\\r\\n## Task 3\\r\\n- **The reverse engineering team need the malicious file sample to analyze. Your SOC manager instructed you to find the hash of the file and then forward the sample to reverse engineering team. What\'s the md5 hash of the malicious file?**\\r\\n\\r\\nWe need to get the MD5 hash of the malicious `svchost.exe` file. I ran volatility3 with the `-h ` flag so that I could see all the the options and plugins available. I narrowed down the search using `grep` to filter for any occurrences of the the word *file*. This should provide a function/plugin that will allow us to see the files in the filesystem of the memory dump file. \\r\\n![](img/6935a0a188447c883cd228b6caf27b95.png)\\r\\nLooks there is a function/plugin called **windows.filescan**, which after some research, I found that it allows for listing of all file objects that were found in memory at the time of the dump. \\r\\n![](img/8729767967c58ed2f32dd3a79e5c134e.png)\\r\\n\\r\\nUsing this function/plugin, along with `grep` filter the output and place it into a text file, using the command below. \\r\\n```bash\\r\\npython vol.py -f python vol.py -f /media/sf_D_DRIVE/HTB-Sherlocks/RogueOne/20230810.mem windows.filescan | grep svchost.exe > svchost_filescan.txt\\r\\n```\\r\\n\\r\\nLooking through the `svchost_filescan.txt` I can clearly see an `svchost.exe` file located in a folder that is not in the Windows directory, located in a the user, **simon-stark\'s**, downloads folder.  \\r\\n![](img/cfacd4ebc59a847c0d68e88631284832.png)\\r\\n### File Extraction\\r\\nWe now know the location of the malicious file but, are we able to extract it out of the memory dump file? Does volatility3 have the functionality to do this? The answer to both questions is **yes**. \\r\\n\\r\\nWhen I was looking up functions/plugins to use in order to list all of the files in the memory dump, I cam across the plugin `windows.dumpfiles`.\\r\\n![](img/412539544b9c863cbe98d9a5066cfef9.png)\\r\\nNow we craft the complete command so that we can extract the file out of the memory dump.\\r\\n```bash\\r\\npython vol.py -f /media/sf_D_DRIVE/HTB-Sherlocks/RogueOne/20230810.mem windows.dumpfiles --pid 6812 \\r\\n```\\r\\n![](img/70e28cecde09008eaf409e635b544e84.png)\\r\\nAbove you can see that the `svchost.exe` was dumped out an an `.img` file, along with the DLLs that the application must have been accessing to run. The `.img` file is a raw dump format that is a binary blob of the file as it appeared in memory at the time of capture. \\r\\n### Hashing\\r\\nNow that we have the image file of the malicious file we need to get a hash of the file to provide to the reverse engineering team mentioned in the task. To do this we can use the pre-installed **md5sum** command line utility. Most distributions of Linux have this utility installed by default as a part of the GNU Core Utilities package. \\r\\n\\r\\nThe command used to get the md5sum is as follows:\\r\\n```bash\\r\\nmd5sum file.0x9e8b91ec0140.0x9e8b957f24c0.ImageSectionObject.svchost.exe.img\\r\\n```\\r\\nWhich gives use the output, containing the MD5 hash and the filename. The hash being **5bd547c6f5bfc4858fe62c8867acfbb5**, which is the answer to Task 3.\\r\\n## Task 4\\r\\n- **In order to find the scope of the incident, the SOC manager has deployed a threat hunting team to sweep across the environment for any indicator of compromise. It would be a great help to the team if you are able to confirm the C2 IP address and ports so our team can utilize these in their sweep.**\\r\\n\\r\\nThis task requires us to dig into the `windows.netscan` plugin that is pre-installed with Volatility3. With the Linux Mint VM that I had setup, volatility was not detecting that the memory dump file had data that could be scanned with the plugin, so I created a new VM and installed Kali Purple, which is a Linux distro targeted at purple/blue team use, which is more suitable for carrying out investigations and also has a lot of SOC Analyst software pre-installed. \\r\\n\\r\\nI believe now, after looking into the situation, that the file had been only partially extracted from the archive, the memory dump that I was accessing with volatility3 was only 2.7gb in size, with the file in kali purple, after fully being extracted from the archive, was around 4gb in size. Whoops!\ud83d\ude1d\\r\\n\\r\\nSo, here is the truncated output.\\r\\n![](img/6b7a134109b41851933036b02589823d.png)\\r\\nThe first thing that jumps out to be is a connection to an IP address, **13.127.155.166** with the port **8888**. \\r\\n![](img/9227a23fead3b17a69b2c8fc5aef4eee.png)\\r\\nFrom what I know about services, networking, and ports, and from running some services on home server, port 8888 is used for some self-hosted services. I did some research on the port and what it has been historically used for. [WhatPortIs.com](https://whatportis.com/ports/8888_http-web-interface-alternative) states that the port is commonly used for http & https traffic as an alternative port, if there are multiple services providing http/https functionality. [SpeedGuide.net](https://www.speedguide.net/port.php?port=8888) states that the port is used for *\\"allhttpd\\"* but, also states that it could be related to malware and trojans, things are looking fishy \ud83d\udc1f.\\r\\n\\r\\nMoving on to the IP address, I did some research on websites that contained databases of IP addresses that could be associated with botnets & C2 Command and Control servers. I landed at [Cisco Talos](https://talosintelligence.com/reputation_center/), which allows  for searching of IP addresses, providing information on if the IP address has been used in malicious acts, exactly what we need. \\r\\n\\r\\nThe search itself did not turn up anything of note, IP address originates from Mumbai, India bit the IP address is rated as neutral in nature.\\r\\n![](img/3b792a7166d7d200f514d24bceba9884.png)\\r\\n\\r\\nJudging from this entry being the only entry from an `svchost.exe` process and it\'s the only one to be connecting to a foreign IP on a non-standard port, we should be on the right track. I went ahead and entered the IP found and port,  **13.127.155.166:8888**. This turned out to be the correct answer. \\r\\n![](img/99175462031af18f1aab198ba46a4b26.png)\\r\\n## Task 5\\r\\n- **We need a timeline to help us scope out the incident and help the wider DFIR team to perform root cause analysis. Can you confirm time the process was executed and C2 channel was established?**\\r\\nTo get the answer for this task we can look at the time that the connection was established. In the previous question we used the `windows.netstat` volatility plugin to get a list of connections that were established leading up to the event. It also provided us with timestamps for when these connections took place. \\r\\n\\r\\n![](img/9227a23fead3b17a69b2c8fc5aef4eee.png)\\r\\nLooking back at the above image, we can see that the time of connection to the C2 server was at **10/08/2023 11:30:03**. Note that we could have also gotten this answer via using the `windows.pstree` plugin, which allows for checking of parent-child relationships and provides timestamps as to when processes where initially executed.  \\r\\n![](img/c3f278d2c5df55ab1478fa8cc66d6897.png)\\r\\n## Task 6\\r\\n- **What is the memory offset of the malicious process?**\\r\\nThe offset can be found via the above mentioned `windows.pstree`. It allows us to see, as mentioned before, parent-child relationships and when a process was executed. Looking at the malicious `svchost.exe` that after being launched created a child `cmd.exe` process, we can get the offset of the malicious file, which is **0x9e8b87762080**. \\r\\n![](img/89793110be8d531f657bd7a4ab07cc4e.png)\\r\\n## Task 7\\r\\n- **You successfully analyzed a memory dump and received praise from your manager. The following day, your manager requests an update on the malicious file. You check VirusTotal and find that the file has already been uploaded, likely by the reverse engineering team. Your task is to determine when the sample was first submitted to VirusTotal.**\\r\\nNice, okay so we can use the hash of the malicious `svchost.exe` file that we gathered as the result of [[#Task 3]], which was **5bd547c6f5bfc4858fe62c8867acfbb5**. So, we load up [VirusTotal](https://www.virustotal.com/gui/home/search) and navigate to search and input the hash.\\r\\n![](img/3c2a636693291df9c1b033fe703081ae.png)\\r\\n\\r\\nAnd we get a result, the file indeed is on virustotal, and is indeed malicious in nature, as we have already confirmed. \\r\\n![](img/f8712dc71fd8059bfe677e388f5af5a5.png)\\r\\n\\r\\nNavigating to the details section of the entry in virustotal, and it looks like the file was first submitted on **2023-08-10 11:58:10 UTC**. \ud83c\udf89\\r\\n![](img/1b05997badd8edc600002d09da18a9dd.png)\\r\\n\\r\\n## Key Takeaways\\r\\n- The volatility framework is a powerful tool in memory forensics that can be used on Windows, Mac, & Linux.\\r\\n- Volatility has a host of plugins that work with supported Operating Systems, allowing for in depth memory analysis and investigation.\\r\\n- Capturing images of a compromised systems filesystem and memory is a critical component in the incident response process, providing ways to investigate possible compromised machines, without the need to keep them on the network.\\r\\n- Cisco Talos is a repository of IP address information. Providing insights on if a particular IP address is a part of a botnet or has been used in malicious activities."},{"id":"Noxious-HTB-Sherlocks","metadata":{"permalink":"/blog/Noxious-HTB-Sherlocks","source":"@site/blog/2024-10-31-Noxious-Sherlock/index.mdx","title":"Noxious (HTB-Sherlocks)","description":"HTB Sherlock Noxious investigation focused on LLMNR poisoning and NTLM capture.","date":"2024-10-31T00:00:00.000Z","tags":[{"inline":true,"label":"Labs","permalink":"/blog/tags/labs"},{"inline":true,"label":"Hackthebox","permalink":"/blog/tags/hackthebox"},{"inline":true,"label":"Incident-Response","permalink":"/blog/tags/incident-response"},{"inline":true,"label":"NTLM","permalink":"/blog/tags/ntlm"},{"inline":true,"label":"LLMNR","permalink":"/blog/tags/llmnr"},{"inline":true,"label":"HashCat","permalink":"/blog/tags/hash-cat"},{"inline":true,"label":"Offline-BruteForce","permalink":"/blog/tags/offline-brute-force"}],"readingTime":17.02,"hasTruncateMarker":true,"authors":[{"name":"Dario Cruz","title":"Maintainer of DarioCruz.dev","url":"https://github.com/dario-cruz","imageURL":"https://github.com/dario-cruz.png","key":"dcruz","page":null}],"frontMatter":{"slug":"Noxious-HTB-Sherlocks","title":"Noxious (HTB-Sherlocks)","description":"HTB Sherlock Noxious investigation focused on LLMNR poisoning and NTLM capture.","keywords":["Hack The Box","Sherlock","Noxious","LLMNR","NTLM"],"image":"/img/itsmedario.webp","authors":["dcruz"],"tags":["Labs","Hackthebox","Incident-Response","NTLM","LLMNR","HashCat","Offline-BruteForce"],"enableComments":true},"unlisted":false,"prevItem":{"title":"RogueOne (HTB-Sherlocks)","permalink":"/blog/RogueOne-HTB-Sherlocks"},"nextItem":{"title":"Security+ Passed!","permalink":"/blog/Security-Plus-Passed"}},"content":"![Noxious](img/98966c960819afc7d536fa03a8d5918d.webp)\\r\\nOkay, lets get back into it! Time for another Sherlock investigation.\ud83d\udd75\ufe0f\u200d\u2642\ufe0f\\r\\n## Scenario\\r\\n> The IDS device alerted us to a possible rogue device in the internal Active Directory network. The Intrusion Detection System also indicated signs of LLMNR traffic, which is unusual. It is suspected that an LLMNR poisoning attack occurred. The LLMNR traffic was directed towards Forela-WKstn002, which has the IP address 172.17.79.136. A limited packet capture from the surrounding time is provided to you, our Network Forensics expert. Since this occurred in the Active Directory VLAN, it is suggested that we perform network threat hunting with the Active Directory attack vector in mind, specifically focusing on LLMNR poisoning. \\r\\n## The Files\\r\\nOkay so in the zip file for the Sherlock we have a single `.pcap` file which means we will be flexing our Wireshark/TCPdump skills in this investigation. \\r\\n\x3c!-- truncate --\x3e\\r\\n## Task 1\\r\\n**Its suspected by the security team that there was a rogue device in Forela\'s internal network running responder tool to perform an LLMNR Poisoning attack. Please find the malicious IP Address of the machine.**\\r\\n\\r\\nHmmmm, okay so the acronym LLMNR is new to me, so it\'s time to educate myself on that it means, and also how it can be used by a threat actor that has access to an organizations network. \\r\\n### Link-Local Multicast Name Resolution\\r\\nSo, it\'s a network protocol, and it\'s based on the DNS packet format. It allows both IPv4 and IPv6 hosts and devices to perform name resolution on the same network link. [^1]\\r\\n\\r\\n[^1]: https://en.wikipedia.org/wiki/Link-Local_Multicast_Name_Resolution\\r\\n### How LLMNR works\\r\\nOkay so digging deeper into how the protocol works, so that we know what the normal baseline behavior should be, looking at this image [^3] it looks like LLMNR works similar to DNS, meaning that a central server is responsible for requests, this means that any deviation in where requests are sent and responded to, should provide us with information on the machine that is on the network carrying out the attack. \\r\\n#### LLMNR Poisoning Attacks\\r\\nHow can LLMNR be poisoned? How can it be used to attack a system? According to [this article](https://attack.mitre.org/techniques/T1557/001/) from MITRE, adversaries will spoof and present themselves as an authoritative source for name resolution, allowing for the threat actor to collect and/or relay authentication data. Yikes! Threat actors will respond to LLMNR requests as though they know the identity of the requested host, poisoning the service and getting the victims to communicate with the threat actor controlled system. \\r\\n\\r\\nThe goal of the attack is to collect hashes used in authentication which could be used for cracking of the hashes via offline brute forcing, leading to the obtaining of account passwords. [^2]\\r\\n\\r\\n[^2]: https://attack.mitre.org/techniques/T1557/001/\\r\\n[^3]: https://www.aptive.co.uk/wp-content/uploads/2017/02/responder-llmnr-netbios-name-server-spoofing.png\\r\\n\\r\\n##### Detection\\r\\nLucky for us, on the same page of this article MITRE provides information on how to detect the incident. More specifically, since we only have access to the pcap of the security incident and not the Windows logs of the machines affected, we can narrow our focus to the Network Traffic data source. \\r\\n![](img/c3788c4419312e5e98f8d09f444eec49.png)\\r\\n- Monitor network traffic on UDP Ports **5355** and UDP **137**, if LNMR is disabled via security policy. \\r\\n- Monitor network traffic originating from **unknown/unexpected hardware devices**. \\r\\n### Investigating Further\\r\\nOkay so now it\'s time to open up that `.pcap` file and start the investigation, we are looking for the IP address of the machine that is carrying out the LLNMR poisoning attack. From our enumeration and information gathering, we know that the ports to check are UPD **5355** & **137**, so in Wireshark we will filter for that starting with port **5355**, `upd.port == 5355`. \\r\\n![](img/18d67820bd23ef498df0f0a320f36188.png)\\r\\n\\r\\nLooking at the above image we can see a series of normal requests to the DC01 server, the server is processing the requests form machines on the network as normal. \\r\\n![](img/a383e27f6efbf38856dc340316101c9c.png)\\r\\nScrolling down further reveals some intriguing network traffic. \\r\\n![](img/f4a3b2fb2aa22e9af2a861ed56780442.png)\\r\\nTowards the end of the pcap file we can see that query responses are no longer coming from the DC01 server. Query responses are now being handled by **172.17.79.135**, which is the IP address needed answer the task question.\\r\\n## Task 2\\r\\n**What is the hostname of the rogue machine?** \\r\\nOkay so now that we know the IP address of the machine that is carrying out the LLMNR poisoning attack, it should be easy to find the hostname of the machine. \\r\\n\\r\\nTaking what we have learned form the MITRE information on LLMNR poisoning attacks and how they are carried out, we know we can use DHCP to potentially find information on the threat actor machine. So, back into Wireshark we go, filtering for the IP address that we have found and narrowing down the search by scoping down to only DHCP protocol activity. With that we get 3 network events.\\r\\n![](img/7bb19b78cc05701747389245c7de9e40.png)\\r\\nWith the 3 log events we can see that there was a DHCP request from this IP address. and digging into the log details we see that there is a field for the hostname of the requesting computer, in this case the threat actors machine hostname is **kali**. (Kali Linux bby!\ud83d\ude0e)\\r\\n## Task 3\\r\\n**Now we need to confirm whether the attacker captured the user\'s hash and it is crackable!! What is the username whose hash was captured?**\\r\\n### LLMNR Poisoning and Hashes\\r\\nOkay so how are LLMNR attacks related to password hashes and the cracking of them? For this lets go back to the MITRE documentation on the attack. Reading through the material, I found this snippet that explains how hashes can be obtained as a result LLMNR poisoning attacks:\\r\\n> (After initial LLMNR poisoning has been carried out.) \xa0If the requested host belongs to a resource that requires identification/authentication, the username and NTLMv2 hash will then be sent to the adversary controlled system. The adversary can then collect the hash information sent over the wire through tools that monitor the ports for traffic or through\xa0[Network Sniffing](https://attack.mitre.org/techniques/T1040)\xa0and crack the hashes offline through\xa0[Brute Force](https://attack.mitre.org/techniques/T1110)\xa0to obtain the plaintext passwords.\\r\\n\\r\\nand also...\\r\\n>In some cases where an adversary has access to a system that is in the authentication path between systems or when automated scans that use credentials attempt to authenticate to an adversary controlled system, the NTLMv1/v2 hashes can be intercepted and relayed to access and execute code against a target system.\\r\\n### Further investigation\\r\\nOkay so now that we know that the threat actor could potentially be exploiting LLMNR to carry out poisoning and a man-in-the-middle attack to obtain hashes and crack those hashes and attempt to login to a compromised account via NTLM, we will look for indicators of such via further Wireshark filtering. \\r\\n\\r\\nFirst lets filter for NTLM traffic, and oh boy we find some clear indicators...\\r\\n![](img/6f2b4a46c29981f672959dcf23e6c878.png)\\r\\nLooks like we are getting some brute force traffic on the SMB port 412 and also multiple session setup requests on the user account **Forela\\\\john.deacon**, the final answer to the task question being **john.deacon**. \\r\\n## Task 4\\r\\n**In NTLM traffic we can see that the victim credentials were relayed multiple times to the attacker\'s machine. When were the hashes captured the First time?**\\r\\n\\r\\nPretty straight forward, as we have already filtered for smb2 traffic. We can look at the time stamps and check for the first instance of the **john.deacon** user account hash being brute forced over the network. \\r\\n![](img/9b045d4bb6e5bb04be25707e2764e016.png)\\r\\nThe brute forcing of the hash for user account john.deacon took place on **2024-06-24 11:18:30**.\\r\\n## Task 5\\r\\n**What was the typo made by the victim when navigating to the file share that caused his credentials to be leaked?**\\r\\n\\r\\nOkay so we have information that the user john.deacon made a typo in the SMB share why does this matter and how did it leak the credentials of the users account? This probably has to do with the LNMRR poisoning as smb share hostnames are resolved to IP addresses and where does that resolution happen, via DNS and in this case with the dual IP addressing protocol nature of the network, LNMRR. So lets take a look at those network logs. \\r\\n![](img/71571c0f74f8ccfe49260398944ce1a3.png)\\r\\nSo we see some broadcast traffic of the server DC01 announcing it\'s presence. SMB servers have a feature that allows them to advertise their presence on a local network, for security this should probably be disabled as it allows threat actors to enumerate smb servers and shares and potentially exploit them. \\r\\n\\r\\nLooking back at the network logs of the LLNMR attack, we can see that the victim that had their credentials compromised had mistakenly typed the hostname **DCC01** when attempting to access the smb server/shares. \\r\\n![](img/028970dab294f9334460114d0d6aae4a.png)\\r\\n## Task 6\\r\\n**To get the actual credentials of the victim user we need to stitch together multiple values from the ntlm negotiation packets. What is the NTLM server challenge value?**\\r\\n\\r\\nFor this one a roped in ChatGPT for some clarification on the NTLM protocol and the structure of it\'s packets. The task charges us with finding the *server challenge value* and that, *\\"To get the actual credentials of the victim we need to stich together multiple values from the NTLM negotiation packets\\"*.\\r\\n### Educating myself with ChatGPT\\r\\nI prompted ChatGPT with the following message:\\r\\n> Explain the structure of ntlm negotiation packets. The context for this task is that I am investigation a security incident, and I need to obtain the NTLM server challenge value that the threat actor obtained.\\r\\n\\r\\nAnd ChatGPT proceeded to give me a wealth of information. More specifically, instructions on how to extract the server challenge value, nice! \ud83d\ude0e\\r\\n\\r\\n> [!NOTE] Steps to Extract the Server Challenge Value \\r\\n>1. **Capture NTLM Traffic**:\\r\\n>    - Use network monitoring tools like Wireshark to capture the traffic during the NTLM authentication process.\\r\\n>    - Apply filters in Wireshark to isolate NTLM packets. The filter `ntlmssp` can be used to find these packets specifically.\\r\\n>2. **Locate the NTLM Challenge Message**:\\r\\n>    - Look for the message with a type field of `0x00000002`, which indicates the NTLM challenge message.\\r\\n>3. **Extract the Server Challenge**:\\r\\n>    - The server challenge is located 8 bytes after the \\"Negotiate Flags\\" field.\\r\\n>    - In Wireshark, expand the NTLMSSP fields within the NTLM challenge message to locate the \\"Server Challenge\\".\\r\\n>    - The value will be a 64-bit (8-byte) hexadecimal number (e.g., `0xA1B2C3D4E5F6A7B8`).\\r\\n>4. **Verify the Challenge**:\\r\\n>    - Ensure that the challenge aligns with the expected structure, and cross-reference with other packets to see how the client responded using this challenge.\\r\\n### The Solution\\r\\nChatGPT broke it down for me and now I have the details I need to hunt for the answer, NTLM has a series of steps for the authentication process, there are 3 different packets, which are the following, Negotiation Message, Challenge Message, and Authentication Message. The NTLM Challenge packets will be the ones that we are targeting. \\r\\n\\r\\nBack to Wireshark we filter for `ntlmssp` packets and we can see the Challenge Message packets clearly.\\r\\n![](img/8ede64a723be6efcbf035f5c42c26d9a.png)\\r\\nLooking at the first of the challenge packets details, scrolling down to the NTLM specific parts of the packet we can see the first challenge message, from when the threat actor carried out their brute force of the users account. \\r\\n![](img/c19eac34ce74fdc7565bc89136d0f1a8.png)\\r\\nThe NTLM server challenge value for the first challenge packet is **601019d191f054f1**, which is the answer to the task question. \\r\\n## Task 7\\r\\n**Now doing something similar find the NTProofStr value.**\\r\\n\\r\\nNow our target is the NTProofStr value but, wait what is that? Looking back at the ChatGPT info there is no mention of this value in the information provided....\\r\\n> [!NOTE] Hey ChatGPT what is NTProofStr in relation to the NTLM protocol?\\r\\n> Response: \\r\\n> *In the NTLM protocol, **`NTProofStr`** (often called **NT Proof String**) is a key component of the NTLMv2 authentication process. It is a critical part of the client\'s response during the authentication process, specifically in the **NTLM Authenticate Message**.*\\r\\n\\r\\nCool, so now we need to target and filter for the ntlm authentication packets and look for the value of the NTProofStr.\\r\\n\\r\\nLooking at the packet that came right after the first ntlm challenge, we see an NTLM authentication packet, attempting to authenticate the user `john.deacon`.\\r\\n![](img/66614e4e754b222469292e72d086b1c0.png)\\r\\nNow looking at the details of the NTLM authentication packet, we see the response type, and also the NTProofStr value, which is **c0cc803a6d9fb5a9082253a04dbd4cd4**.\\r\\n![](img/f8993266c9ce839b99d6467353b06177.png)\\r\\n## Task 8\\r\\n**To test the password complexity, try recovering the password from the information found from packet capture. This is a crucial step as this way we can find whether the attacker was able to crack this and how quickly.**\\r\\n\\r\\nSo we need to recover the password? Well, okay lets research how to do that. ChatGPT comes into play again and I ask it the following:\\r\\n\\r\\n> [!NOTE] How do threat actors crack user passwords using the NTLM protocol?\\r\\n> *Response Highlights:*\\r\\n>**NTLM hashes** are representations of the user\u2019s password in hash form, which is used during authentication instead of the plaintext password. If an attacker can capture these hashes (e.g., through a network sniffing attack or by extracting them from compromised machines), they can attempt to crack them offline.\\r\\n>\\r\\n>If an attacker captures the NTLM hash `aad3b435b51404eeaad3b435b51404ee:32ed87bdb5fbb310bc9ef504a40265b1`, they can attempt to use **Hashcat** with a wordlist to brute-force the plaintext password.\\r\\n\\r\\nLooks like we have to gather the hashes from the NTLM packets and attempt to crack them with **Hashcat**. I spun up a Linux VM and proceeded to install hash cat and look for wordlists to use. \\r\\n![](img/7623b54e81df73f9142230f9c26585b0.png)\\r\\n\\r\\nRunning Hashcat for the first time with the -h flag(help menu) shows all the flags, parameters and how they can be used to crack hashes or complete other tasks. The list is expansive. \\r\\n![](img/4a3025330a06c9ec4502df86901a4953.png)\\r\\n\\r\\nLooking for wordlists I found this resource on github, https://github.com/gmelodie/awesome-wordlists and proceeded to download the *RockYou* password list as the description read, *The go-to wordlist for passwords*. \\r\\n\\r\\nAfter getting the wordlists and hashcat installed I looked for some guidance on basic usage of the cli app and found an article on freecodecamp https://www.freecodecamp.org/news/hacking-with-hashcat-a-practical-guide/. The syntax we should use to brute force and find that password should be the following\\r\\n```bash\\r\\nhashcat -m 0 -a0 hashes.txt rockyou.txt\\r\\n```\\r\\n### Cracking NTLM\\r\\nI went ahead and created a folder that store the `rockyou.txt` and also the `hashes.txt` files. We need to gather the hashes from the `.pcap` file and place them in the hashes file so that \\r\\nHashCat can process them and find a match.\\r\\n#### NTLM Challenge Response\\r\\nAfter doing some research on the NTLM protocol and how threat actors exploit the way it works, in order to carry out **Man-In-The-Middle** attacks, I found that the NTLM Challenge Response is the field that contains the hash-based validation of the password, along with other information, like the **NTProofStr** value that we collected earlier. \\r\\n![](img/898efcb82e1d389ba592c4b3d732b4be.png)\\r\\nSo I gathered all the NTLMv2 response hashes from the packet capture file and stored in the `hashes.txt` file, so that they can be access an processed using hashcat.\\r\\n![](img/378feb9f0dafca90dc32f591543c00bc.png)\\r\\nThere was an issue though, when attempting to run hashcat on the file, with the proper syntax, hashcat was presenting me with errors about the hash format. \\r\\n![](img/df22b4700beeb6267e76528da7c68e44.png)\\r\\nHere is the syntax that I used after looking at the documentation for hashcat and the guide on how to use it, that I found on [freecodecamp](https://www.freecodecamp.org/news/hacking-with-hashcat-a-practical-guide/).\\r\\n```bash\\r\\nhashcat -m 5600 -a 0 -o cracked.txt hashes.txt rockyou.txt\\r\\n```\\r\\n*The `-m 5600` flag and arg, tell hash cast to use the HMAC-MD5 hashing algorithm, which is the hashing method that NTLMv2 uses. The `-a 0` configures hashcat to carry out a normal Dictionary Attack using the provided wordlist in the `rockyou.txt` file. Lastly, the `-o` flag specifies where the results of the process should be stored, which is inside of the `cracked.txt` file.*\\r\\n\\r\\nI began to dig into what the cause of the issue was and see how I could correct the formatting. Doing google searches and ChatGPT queries. I came across this video, which detailed, how to obtain the NTLMv2 hash, along with other information that hashcat required, as well has how to format the file that stored the information. *Super useful!\ud83d\ude04  Shoutout to [Embrace The Red](https://www.youtube.com/@embracethered)\ud83c\udf7b*\\r\\n\\r\\n<iframe width=\\"560\\" height=\\"315\\" src=\\"https://www.youtube.com/embed/lhhlgoMjM7o?si=Mx6wIhsMwPTYCJvz\\" title=\\"YouTube video player\\" frameborder=\\"0\\" allow=\\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\\" referrerpolicy=\\"strict-origin-when-cross-origin\\" allowfullscreen></iframe>\\r\\n\\r\\nLooks like the format of the content in the file needs to be structured via  the format: \\r\\n```\\r\\nusername::domain::challenge_value::HMAC-MD5_value::NTLMv2Resposne(Without fist 16 bytes)\\r\\n```\\r\\nSo I created a new file `ntlm-hashes.txt` and typed out the needed format. Time to gather the data from the packet capture file. \\r\\n\\r\\nFirst we need the **NTLM Server Challenge** value. Looking at the packet capture this would be the first packet that is sent to the NTLM server, by the client, requesting authentication and access. I my case I am targeting the first 3 packets in the capture file, after filtering for `ntlmssp`. \\r\\n![](img/6c9061d3c0d2e86f2e3f3ba97fcbb047.png)\\r\\n![](img/6ebe4845dc91f371639a819188adb6a2.png)\\r\\nSecond, we need the **NTLMv2 Response**, which we find in the same packet further down the packet details, just like in our previous attempt.\\r\\n![](img/cd3b1e4187b42ee4febb23029bb57f2c.png)\\r\\nThird, we need to obtain the **HMAC-MD5** value for hashcat, according to the information in the video, the **NTProofStr** is the HMAC-MD5 value. It is also the first 16 bytes of the challenge response. \\r\\n![](img/a3d0ea066bc7f21eb2eaf297b8c91a7b.png)\\r\\nAnd for the last two values, User and Domain, we scroll down further in the packet details to find those values under the *domain name* & *user name* attributes. \\r\\n![](img/89cbf79b5d85adceafbb5fb7bedeeb62.png)\\r\\nHere we have, the final result of gathering all the need attribute values stored in the `ntlm-hashes.txt`.\\r\\n```\\r\\njohn.deacon::FORELA: 53b0e5778af9adfb:8573cf0b2b03b84ba6caef21cd43a303:010100000000000080e4d59406c6da0153b0e57....\\r\\n```\\r\\nNow we use hashcat to do an offline brute force of the NTLMv2 hash. Below is the refined command to run:\\r\\n```shell\\r\\nhashcat -a0 -m5600 ntlm-hashes.txt rockyou.txt\\r\\n```\\r\\nAnd here is the terminal output from the command and the resulting password for the user account. \\r\\n![](img/b2bbd96796f272fecdd34c38d1565ada.png)\\r\\n**The answer to the task question is the password `NotMyPassword0k?`**\\r\\n## Task 9\\r\\n**Just to get more context surrounding the incident, what is the actual file share that the victim was trying to navigate to?**\\r\\n\\r\\nFor this task we will need to take a look at the log files that lead up to the malicious event. We know that the user was attempting to access a file share but, entered the wrong file share path, which in turn lead to their account becoming compromised.  In task 5 we found the typo that the user had mistakenly typed in, which was `DCC01`. Looking through the packet capture file, we can see that right before the LLMNR pensioning took place, the user was attempting to access the file share, **`\\\\\\\\DC01\\\\DC-Confidential`**, which is the answer to the Task 9 Question.\\r\\n![](img/b8e02d6e56baed79311e79178c8b37d1.png)\\r\\n## **Key Takeaways**\\r\\n- **LLMNR (Link-Local Multicast Name Resolution)** is a protocol that is used in Windows networks, it allows for the resolution of local network hostnames to IP addresses when DNS is not available. It is susceptible to **Man-in-the-middle (MITM) & Poisoning Attacks**, due to it\'s lack of *verifying the identity of devices that respond to the name resolution requests*. **Poisoning of LLMNR** takes place when a threat actor exploits this lack of *verification* and **impersonates the the LLMNR requesting service**, allowing for the threat actor to receive traffic flows that contain sensitive information, which in this case lead to an corresponding **NTLMv2 hash brute force**.\\r\\n- **NTLM(Windows New Technology LAN Manager)** and it\'s **Version 2** variant are used to *authenticate users* via a **challenge-response mechanism**. With **NTLMv2** the challenge-response mechanism uses HMAC-MD5 hashes that can be obtained via *traffic capture* or *Man-In-The-Middle attacks* and used for *offline brute forcing*, using a number of tools that are available, including the tool which we used for this investigation, *HashCat*. NTLM as a protocol should be disabled as is has been *[deprecated by Microsoft](https://learn.microsoft.com/en-us/windows/whats-new/deprecated-features)*, and there are more modern protocols like Kerberos that accomplish the same functionality while being secure."},{"id":"Security-Plus-Passed","metadata":{"permalink":"/blog/Security-Plus-Passed","source":"@site/blog/2024-10-29-SecurityPlusPassed/index.mdx","title":"Security+ Passed!","description":"Passing CompTIA Security+ (SY0-701) with study notes and takeaways.","date":"2024-10-29T00:00:00.000Z","tags":[{"inline":true,"label":"certifications","permalink":"/blog/tags/certifications"},{"inline":true,"label":"comptia","permalink":"/blog/tags/comptia"},{"inline":true,"label":"security-plus","permalink":"/blog/tags/security-plus"}],"readingTime":1.71,"hasTruncateMarker":true,"authors":[{"name":"Dario Cruz","title":"Maintainer of DarioCruz.dev","url":"https://github.com/dario-cruz","imageURL":"https://github.com/dario-cruz.png","key":"dcruz","page":null}],"frontMatter":{"slug":"Security-Plus-Passed","title":"Security+ Passed!","description":"Passing CompTIA Security+ (SY0-701) with study notes and takeaways.","keywords":["Security+","CompTIA","certification","cybersecurity","study"],"authors":["dcruz"],"tags":["certifications","comptia","security-plus"],"image":"blog/Security-Plus-Passed/img/78e2c33e2483c4cf74d88bc2565c1e9a.png","enableComments":true},"unlisted":false,"prevItem":{"title":"Noxious (HTB-Sherlocks)","permalink":"/blog/Noxious-HTB-Sherlocks"},"nextItem":{"title":"Reaper(HTB-Sherlocks)","permalink":"/blog/Reaper-HTB-Sherlocks"}},"content":"![DCruz-SecPlus](img/78e2c33e2483c4cf74d88bc2565c1e9a.png)\\r\\nHey all,\\r\\n\\r\\nApologies for the radio silence! Work has ramped up, and I\'ve been focused on my studies, as you can see. \ud83d\ude06 Last Friday, on Oct 25, I sat down and took the Security+ SY0-701 certification exam\u2014and passed! \ud83c\udf89\\r\\n\x3c!-- truncate --\x3e\\r\\n\\r\\n## The Exam Experience\\r\\nOut of all the exams I have taken so far, I feel that the difficulty level of this exam was moderate. It would be harder if you took the exam without any prior IT experience. My exam comprised 3 performance-based questions, in which I had to use my knowledge to complete a set of tasks, and 72 multiple-choice questions\u201475 questions in total. As long as you have a study guide or a video course that covers all the exam domains, you should be fine. I took the time to dig deeper into specific topics, most notably **Cryptography** and **Public Key Infrastructure**, as those topics alone contain a wide range of technologies and concepts.\\r\\n\\r\\nAdditionally, it\'s pretty important to have a good set of practice exams. For this exam, I didn\u2019t use Anki flashcards. My thinking was that, since I had already learned most of the content through the Google Cybersecurity Professional course, I wouldn\u2019t need additional reinforcement as the concepts were already set in my memory. This approach worked well; any reinforcement of knowledge came from the practice exams, which gave me the needed feel of taking the actual test. My mind was ready! \ud83e\udd13\\r\\n\\r\\n## Resources\\r\\nHere is a list of all of the resources that I used to study for the exam:\\r\\n- [SY0-701 Study Guide by Joe Shelly & Darril Gibson](https://www.amazon.com/CompTIA-Security-Get-Certified-Ahead/dp/B0CM13W88J/ref=sr_1_4?crid=17IQW8C9GRB45&dib=eyJ2IjoiMSJ9.KLwV9SPIB7iofREYr9NL4oNcF-LaIpRh9KHPr1EbVF8M_Ab8IJNiykb57TuvgtB--eez8bj1biPogxJBHHmBcMMVrxQJphARhMSI-wsXtwXi97wgpW4NKRStew5uBpCOe5-xAEVX6B79opQoJWMOzm-JmDkD4EDK-9KQfv59Pp8ginqCP6ZB08qXB7rEFX4ogZ_w_VN1uFp4KMYG6hWR3jEOVziFRPC5Zno3rav0cAw.Y0V_3IKnVq8szP6-AV0diTzQXXUrjePowAvGjylbG38&dib_tag=se&keywords=security%2B+701&qid=1730214671&sprefix=security%2B+%2Caps%2C229&sr=8-4)\\r\\n- [Josh Madakor Security+ Practice Questions - LognPacific](https://lognpacific.com/free-certification-practice-tests/free-security-sy0-701-practice-questions/)\\r\\n- [WhizLabs Security+ SY0-701 Practice Exams](https://www.whizlabs.com/comptia-security-plus-sy0-701/)"},{"id":"Reaper-HTB-Sherlocks","metadata":{"permalink":"/blog/Reaper-HTB-Sherlocks","source":"@site/blog/2024-08-23-Reaper-Sherlock/index.md","title":"Reaper(HTB-Sherlocks)","description":"HTB Sherlock Reaper investigation notes focused on NTLM, NetBIOS, and pass-the-hash.","date":"2024-08-23T00:00:00.000Z","tags":[{"inline":true,"label":"Labs","permalink":"/blog/tags/labs"},{"inline":true,"label":"Hackthebox","permalink":"/blog/tags/hackthebox"},{"inline":true,"label":"Incident-Response","permalink":"/blog/tags/incident-response"},{"inline":true,"label":"Incident-Investigation","permalink":"/blog/tags/incident-investigation"},{"inline":true,"label":"NTLM","permalink":"/blog/tags/ntlm"},{"inline":true,"label":"NetBios","permalink":"/blog/tags/net-bios"},{"inline":true,"label":"Pass-The-Hash","permalink":"/blog/tags/pass-the-hash"}],"readingTime":8.34,"hasTruncateMarker":true,"authors":[{"name":"Dario Cruz","title":"Maintainer of DarioCruz.dev","url":"https://github.com/dario-cruz","imageURL":"https://github.com/dario-cruz.png","key":"dcruz","page":null}],"frontMatter":{"slug":"Reaper-HTB-Sherlocks","title":"Reaper(HTB-Sherlocks)","description":"HTB Sherlock Reaper investigation notes focused on NTLM, NetBIOS, and pass-the-hash.","keywords":["Hack The Box","Sherlock","Reaper","incident response","NTLM"],"image":"/img/itsmedario.webp","authors":["dcruz"],"tags":["Labs","Hackthebox","Incident-Response","Incident-Investigation","NTLM","NetBios","Pass-The-Hash"],"enableComments":true},"unlisted":false,"prevItem":{"title":"Security+ Passed!","permalink":"/blog/Security-Plus-Passed"},"nextItem":{"title":"The Journey So Far","permalink":"/blog/The Journey So Far"}},"content":"![Reaper-HTB-Sherlock](Reaper-Sherlock.webp)\\r\\n\\r\\n## Lets get Labbing\\r\\n\\r\\nOkay so I just discovered Hack The Box Sherlocks, they are Blue Team focused labs that test your SOC Analyst skills. Useful for sharping and displaying knowledge and skills. There looks to be a lot of them which is great, so I decided to jump right in and take a stab at the first lab, a retired lab called Reaper.\\r\\n\x3c!-- truncate --\x3e\\r\\n\\r\\n## Reaper\\r\\n\\r\\nSo, I am on the page and ready to start. I proceeded to read through the scenario, which reads as follows:\\r\\n\\r\\n> Our SIEM alerted us to a suspicious logon event which needs to be looked at immediately . The alert details were that the IP Address and the Source Workstfation name were a mismatch .You are provided a network capture and event logs from the surrounding time around the incident timeframe. Corelate the given evidence and report back to your SOC Manager.\\r\\n\\r\\nThen I downloaded the files for the lab and took a look at them. Here is what they look like:\\r\\n\\r\\n![Intro 1](img/f3e9a82f7ba8eaa466cb4e55a410d4ea.png)\\r\\n\\r\\nOkay so we have a `.evtx` file which is most likely a Windows Log file and also a `.pcapng` file that is a network capture of the event.\\r\\n\\r\\nBefore I proceeded I was asking myself if I needed to spin up a Windows VM or this as the computer that I am using is running Ubuntu Linux. Also, during the Windows Event Log: Finding Evil module for the HTB CDSA, all `.etvw` files where opened using Windows tools like the Event Viewer, SilkETW, and the PowerShell cmd-let `get-winevent`. Now I know there are most likely tools for viewing of these logs on Linux but, for posterity I will use the tools I learned about. Guess it\'s time to spin up that Windows VM.\\r\\n\\r\\ninstalled Gnome Boxes as I heard it was the most minimal type 2 hypervisor for Debian based Linux distros. Downloaded the latest Windows 10 ISO and completed the install. Landing at the desktop I installed spice-webav guest tools, this makes it easier to move files to and from the host to guest OS and vise versa. I also installed 7-Zip as the native Windows OS archive tool does not support password protected `.zip` files. WireShark was also installed on the machine for a nice GUI-based interface that I can use to filter and investigate the `.pcap` file mentioned above. And not bam, here we are at the desktop all ready to go all cyber detective and everything.\\r\\n\\r\\n![Intro 2](img/f58d94b49e61071a0c1a170e77e104e9.png)\\r\\n\\r\\n## Task 1: What is the IP Address for Forela-Wkstn001?\\r\\n\\r\\nOkay, so the first question is asking us for the IP address of the computer hostname **Forela-Wkstn001** so most likely we will be looking at the pcap file as that contains all of the network monitoring logs, which contain details of connections to and from the network, protocols used, IP addresses, MAC addresses etc.\\r\\n\\r\\nOkay so with the pcap file open in WireShark and scrolling through without any filtering I can already see a log form the computer mentioned in the task info. Looks like the NetBios service running on our target machine was attempting to update information of some sort and we can clearly see the source IP address, which is `172.17.79.129`.\\r\\n\\r\\n![Task 1 01](img/2baa86df0ec002574a78804623f296bf.png)\\r\\n\\r\\n### What is NetBios?\\r\\n\\r\\nNetBios is a network protocol that is used for layer 5 (OSI Model) communication over a local network, this communication happens between computers on the local network exchanging data like DNS info, printer sharing, and session management. It\'s a legacy protocol that was used heavily on older versions of Windows but, now not so much. Note that Linux does not natively use NetBios in it\'s networking stack but, most distros of Linux have access to a tool called `netbios-utils`, a command-line utility for interacting with NetBios and other systems using it.\\r\\n\\r\\n## Task 2: What is the IP Address for Forela-Wkstn002?\\r\\n\\r\\nTask 2 is the same exact question but this time for computer **Forela-Wkstn002**. This time we will make use of WireSharks string search abilities.\\r\\n\\r\\n![Task 2 01](img/f3c6ec58a5c134cc54cea1855ae1cf4e.png)\\r\\n\\r\\nAnd yet again we have more NetBios communication and the revealing of the source IP address of the machine, `172.17.79.136`\\r\\n\\r\\n## Task 3: Which user account\'s hash was stolen by attacker?\\r\\n\\r\\nTask 3 is to figure out which account had its\' hash stolen. Wondering if this could be related to the old NetBios protocol being used. If we look at the logs provided and filter for Windows Logon events, Event Code: `4624`, the last 3 entries look very suspicious.\\r\\n\\r\\n![Task 3 01](img/5628302ed4d6d7911eb68b13d7dc8a4b.png)\\r\\n\\r\\nNow if we take a look at the event we can see what looks to be a malicious logon. How do we know it was malicious though? Well, we can see that the **Security ID, Account Name, Account Domain, and Logon ID** all look to be invalid values. Scrolling down further, we can see more indicators of compromise.\\r\\n\\r\\n![Task 3 02](img/b8cec1843f18c156611acf8605e7745d.png)\\r\\n\\r\\nAbove we can see that a new user was logged on to, `aurthur.kyle` from the Domain `FORELA`. This is the first instance of this user logging on in the logs.\\r\\nAlso NTLM was used for the logon as you can see from the next image.\\r\\n\\r\\n![Task 3 03](img/5ada28e45a3ca240117786bdd5453fc2.png)\\r\\n\\r\\n### What is NTLM\\r\\n\\r\\nNTLM is another legacy protocol (lol, sensing a pattern here), that was originally developed in 1990\'s and was used by the Windows OS as an authentication protocol, it was specifically useful for authenticating systems and users in environments where the domain controller was not available.\\r\\n\\r\\nNTLM is also exploitable via Replay and Pass-The-Hash Attacks, and from the looks of it and taking into account the task question, I believe this is what took place.\\r\\n\\r\\n## Task 4: What is the IP Address of Unknown Device used by the attacker to intercept credentials?\\r\\n\\r\\nThis one was easy as the same set of logs that we looked at from the previous task can be used to answer this one. The set of logons using NTLM and the user account `arthur.kyle` all originated from the IP `172.17.79.135`. This can be seen in the Network Information section of the provided windows log file and also in the PCAP file as well.\\r\\n![Task 4 01](img/596162293f8ea3c7fb165eb296706bd6.png)\\r\\n\\r\\nFiltering for the `ntlmssp` protocol in Wireshark displays logs pertaining to NTLM negotiation and NTLM authentication.\\r\\n\\r\\n![Task 4 02](img/f3a1d58d866abb10150ad8ad63c2296d.png)\\r\\n\\r\\n## Task 5: What was the fileshare navigated by the victim user account?\\r\\n\\r\\nFor this task I had already peeped that there were some events pertaining to SMB shares. *I took a look at the hint for this one which read as follows:*\\r\\n\\r\\n> Filter for smb2 traffic in wireshark. Search for keywords \\"BAD_NETWORK_NAME\\" in packet details.\\r\\n\\r\\nOkay so lets filter for smb2 traffic. After applying the filter and scrolling down, I see the \\"BAD_NETWORK_NAME\\" string come up in a set of logs.\\r\\n\\r\\n![Task 5 01](img/89291bdb3b10300a928f183ee28c7c1d.png)\\r\\n\\r\\nThis reveals the SMB share that was navigated to, which was `\\\\\\\\DCO01\\\\Trip`.\\r\\n\\r\\n## Task 6: What is the source port used to logon to target workstation using the compromised account?\\r\\n\\r\\nAnother easy question as the information is contained in sections of both log files that we\'ve looked at already. Image below shows the source port of the logon for the compromised account `aurthur.kyle`.\\r\\n\\r\\n![Task 6 01](img/e008f3c11872b77051878ccfdb9cb6f9.png)\\r\\n\\r\\nAs we can see from the image above the source port for the malicious NTLM logon was port `40252`, which is an ephemeral port, used for temporary outbound connections.  \\r\\n\\r\\n## Task 7: What is the Logon ID for the malicious session?\\r\\n\\r\\nThis can also be found in the same event in the Windows Log file specifically in the *New Logon* section.\\r\\n\\r\\n![Task 7 01](img/0456a9e3c13b5cd74a1967ed651db34f.png)As you can see from the image, the Logon ID is `0x64A799`\\r\\n\\r\\n## Task 8: What is the workstation name and the source IP Address from which the malicious logon occur?\\r\\n\\r\\nTask description also states that, *\\"The detection was based on the mismatch of hostname and the assigned IP Address\\"*. Which I noticed as in the beginning tasks, we established that **Forela-Wkstn001** had an IP of **172.17.79.129** and that \xa0**Forela-Wkstn002** had an IP of **172.17.79.136**. Looking at the log event for the malicious logon we find the following.\\r\\n\\r\\n![Task 8 01](img/200f35380b7bb598dca2bc4b0f3fa5ba.png)\\r\\n\\r\\nThe logon attempt happened on the **Forela-Wkstn002** machine but, from an IP address that is different, **172.17.79.135**.\\r\\n\\r\\n## Task 9: When did the malicious logon happened. Please make sure the timestamp is in UTC?\\r\\n\\r\\nAlright, so same log event and this time a different set of data needed. Also, we must note that the task requests us to change the time to UTC so, depending on the machine your are viewing the logs on, and it\'s configured time zone, the time of the actual event will need to be adjusted to take this into account.\\r\\n\\r\\nI like in the EST time zone so, the time of the event in EST was 12:55:16, converting that into UTC we get, 04:55:16.\\r\\n\\r\\n![Task 9 01](img/a0b857537dd8f266f3ec5ed7ce0f49fa.png)\\r\\n\\r\\nThe final complete answer, including the date as well as the time was `2024-07-31 04:55:16`.\\r\\n\\r\\n## Task 10: What is the share Name accessed as part of the authentication process by the malicious tool used by the attacker?\\r\\n\\r\\nThe last and final task of the Sherlock lab. The answer I saw in passing while browsing through the the log looking for answers to other tasks and getting the lay of the land in terms of what took place. I found that the  Windows event code for file shares is `5140` after a quick google search. I applied the filter to the log file in Event Viewer and got the following.\\r\\n\\r\\n![Task 10 01](img/a4d891b1bfb9cccbb8e7ff14668e271b.png)\\r\\n\\r\\nA single event that took place at the exact same time as the suspicious logon via NTLM, what a coincidence\ud83d\ude1d. The share accessed was `\\\\\\\\*\\\\IPC$`.\\r\\n\\r\\n## Mission Complete!\\r\\n\\r\\n![Mission Complete](img/6a30bc8d976c9615fd7efee1acdcf1d5.png)"},{"id":"The Journey So Far","metadata":{"permalink":"/blog/The Journey So Far","source":"@site/blog/2024-08-01-TheJourneySoFar/index.mdx","title":"The Journey So Far","description":"2024 cybersecurity learning journey, certifications, and next steps.","date":"2024-08-01T00:00:00.000Z","tags":[{"inline":true,"label":"Microsoft","permalink":"/blog/tags/microsoft"},{"inline":true,"label":"Google","permalink":"/blog/tags/google"},{"inline":true,"label":"Azure","permalink":"/blog/tags/azure"},{"inline":true,"label":"Cybersecurity","permalink":"/blog/tags/cybersecurity"},{"inline":true,"label":"Certifications","permalink":"/blog/tags/certifications"},{"inline":true,"label":"Hack-the-box","permalink":"/blog/tags/hack-the-box"}],"readingTime":2.83,"hasTruncateMarker":true,"authors":[{"name":"Dario Cruz","title":"Maintainer of DarioCruz.dev","url":"https://github.com/dario-cruz","imageURL":"https://github.com/dario-cruz.png","key":"dcruz","page":null}],"frontMatter":{"slug":"The Journey So Far","title":"The Journey So Far","description":"2024 cybersecurity learning journey, certifications, and next steps.","keywords":["cybersecurity","certifications","career","SC-300","Google Cybersecurity"],"image":"/img/itsmedario.webp","authors":["dcruz"],"tags":["Microsoft","Google","Azure","Cybersecurity","Certifications","Hack-the-box"],"enableComments":true},"unlisted":false,"prevItem":{"title":"Reaper(HTB-Sherlocks)","permalink":"/blog/Reaper-HTB-Sherlocks"},"nextItem":{"title":"Mastering Identity & Access Management","permalink":"/blog/Mastering Identity & Access Management"}},"content":"![dude-climbing-mountain](dude-climbing-mountain.webp)\\r\\n\\r\\nPhew, it\'s been one hell of a year. At the start of 2024 I made a deal with myself. Progress out of IT Support and take on a new challenge or face the reality that you will be left behind.\ud83d\ude05\\r\\n\\r\\nFor me, I know myself to be the type of person to not let talents, skills, and knowledge go to waste. It nags me to no end and will haunt me like a ghost from one of those 80\'s movies lol.\\r\\n![Ghostbusters](ghostbusters.jpg)\\r\\n\x3c!-- truncate --\x3e\\r\\nSo, I sent my targets on pivoting into Cybersecurity. I wanted to go for a certification or training program that could offer me some skills that I could use in my current role and an IT Support Technician. I landed in the SC300 - Identity and Access Administrator certification from Microsoft for a few reasons.\\r\\n- **I manage and administer to my Organizations Hybrid Active Directory implementation.**\\r\\n- **Microsoft Learn provides all of the training and documentation you need to study & take the exam.**\\r\\n- **Microsoft Certification Exams are reasonably priced.** \\r\\n- **Microsoft Certifications are industry recognized. (It\'s Microsoft lol)**\\r\\n\\r\\nI passed the SC300 exam on May 27th, 2024 with a score of 820, and I have to say seeing that congratulations page made me feel so good.\\r\\n![Dariocru-sc300](dariocru-ms-sc300.png)\\r\\nSince then my manager and some of the higher up IT personnel have allowed me to take on more involved projects around managing of on-prem domain controllers and investigating hybrid sync issues between Azure Entra ID and our on-prem domain controller using Entra Connect Sync.\\r\\n\\r\\nNext up on the list was the Google Cybersecurity Professional Certificate. I chose this certification because of the mix of hands on projects, video, and articles. It\'s a really nice balance for anyone attempting to get into the industry. It gives you hands on time working in Python and SQL which was a lot of fun. *Look out for more in the projects section of the site details of what I have learned.*\\r\\n\\r\\nI achieved the Google Cybersecurity Professional Certification on July 16th 2024. \\r\\n![dariocru-Google-Cyber-Cert](dariocru-google-cyber.jpeg)\\r\\n\\r\\n## Whats next?\\r\\nFrom here I hae a few options. Since completing the GCP, i have a 30% off voucher to take the CompTIA Security+. I have already started to study for it, which shouldn\'t take too much time since the GCP covers topics that are a part of the domains covered in the Sec+. I also know that the cloud is becoming an ever prevalent way for Organizations to role out services, apps, and infrastructure, so it\'s important to know how to carry out security in the cloud. With that in regard I have taking steps toward the AZ-900, finishing the Microsoft Learn course content and scheduling the exam for tomorrow 8/2/2024. \\r\\n\\r\\n### Hack the Box - Certified Defensive Security Analyst\\r\\nHack the Box is a well known cyber range and I have some experience exploring their modules and also using [TryHackMe](https://tryhackme.com). What draws me to the certification is that exam test is all practical. I will be investigating a security incident, performing an analysis, and writing out a report on findings. The exam is graded based on the quality of the report and how thorough the findings are, it sounds like just the type of challenge I need right now. \\r\\n\\r\\n![Challenge Accepted](challenge-accepted.webp)"},{"id":"Mastering Identity & Access Management","metadata":{"permalink":"/blog/Mastering Identity & Access Management","source":"@site/blog/2024-07-07-MasteringIAM/index.mdx","title":"Mastering Identity & Access Management","description":"Essential Pillars for Enhanced Security with Entra ID","date":"2024-07-07T00:00:00.000Z","tags":[{"inline":true,"label":"Microsoft","permalink":"/blog/tags/microsoft"},{"inline":true,"label":"EntraID","permalink":"/blog/tags/entra-id"},{"inline":true,"label":"IAM","permalink":"/blog/tags/iam"},{"inline":true,"label":"Azure","permalink":"/blog/tags/azure"},{"inline":true,"label":"Cybersecurity","permalink":"/blog/tags/cybersecurity"},{"inline":true,"label":"Authentication","permalink":"/blog/tags/authentication"},{"inline":true,"label":"Authorization","permalink":"/blog/tags/authorization"},{"inline":true,"label":"Governance","permalink":"/blog/tags/governance"},{"inline":true,"label":"Compliance","permalink":"/blog/tags/compliance"},{"inline":true,"label":"Monitoring","permalink":"/blog/tags/monitoring"},{"inline":true,"label":"Lifecycle","permalink":"/blog/tags/lifecycle"}],"readingTime":4.91,"hasTruncateMarker":true,"authors":[{"name":"Dario Cruz","title":"Maintainer of DarioCruz.dev","url":"https://github.com/dario-cruz","imageURL":"https://github.com/dario-cruz.png","key":"dcruz","page":null}],"frontMatter":{"slug":"Mastering Identity & Access Management","title":"Mastering Identity & Access Management","description":"Essential Pillars for Enhanced Security with Entra ID","keywords":["IAM","identity","access management","Entra ID","cybersecurity"],"image":"/img/itsmedario.webp","authors":["dcruz"],"tags":["Microsoft","EntraID","IAM","Azure","Cybersecurity","Authentication","Authorization","Governance","Compliance","Monitoring","Lifecycle"],"enableComments":true},"unlisted":false,"prevItem":{"title":"The Journey So Far","permalink":"/blog/The Journey So Far"},"nextItem":{"title":"Site Up and Running","permalink":"/blog/Site Up and Running"}},"content":"![Mastering IAM](mastering-iam.webp)\\r\\n*This post was originally posted to my [Linkedin Profile](https://www.linkedin.com/pulse/mastering-identity-access-management-essential-pillars-dario-cruz-nhsue/?trackingId=FEN9MEiaSUenXkprR4giCQ%3D%3D)*\\r\\n\\r\\n**Identity and Access Management (IAM)** is a framework of policies and technologies that ensure the management and security of accounts, allowing organizations to implement the concept of least privilege when it comes to the amount of access a user has and what resources that access can be applied to.\\r\\n\\r\\nIAM is also a core component of the *CISSP certification*. Let\'s dive into the pillars of Identity and Access Management and how they can be applied to make your organization more secure. We will use the scope of #Entra ID, as #Microsoft has implemented all the necessary controls to carry out Identity and Access Management. \\r\\n\x3c!-- truncate --\x3e\\r\\n## The Pillars of IAM\\r\\n\\r\\nHere are the core concepts that make up IAM:\\r\\n\\r\\n### Identity Management\\r\\n\\r\\nIdentity Management involves the creation, maintenance, and deletion of accounts. Each user is assigned a unique identity that is placed into a repository. Users can manage their own profiles and reset passwords.\\r\\n\\r\\n**Example:** Consider an organization that onboards new employees into its Active Directory/Entra ID system. The user receives account information to access their laptop, email, and other enterprise apps. AD/Entra ID administrators can update the account and make changes if the user changes roles or needs new permissions. The user can update their password and some profile information, like their profile photo. Once the user leaves, the account is marked for deletion based on the organization\'s account handling policies. On the day of off-boarding, the user will no longer have access to their account or any company resources.\\r\\n\\r\\n### Authentication\\r\\n\\r\\nAuthentication verifies the identity of users, devices, or systems, ensuring that the party requesting access is who they claim to be.\\r\\n\\r\\n**Example:** The Contoso Organization has configured its Active Directory/Entra ID systems with MFA, SSO, and Biometrics. When a user attempts to authenticate, they need a second factor of authentication. Users onboard with a fingerprint reader to generate biometric data. This data, along with the username and password, verifies the user\'s identity. SSO allows the user to stay logged in and not be prompted to authenticate when accessing enterprise applications. Admins can adjust the interval or factors required for re-authentication.\\r\\n\\r\\n### Authorization\\r\\n\\r\\nAuthorization determines what an authenticated user is allowed to do. This is achieved by setting up and enforcing policies. Entra ID uses Role-Based Access Control (RBAC), Attribute-Based Access Control (ABAC), and Policy-Based Access Control mechanisms for comprehensive user authorization.\\r\\n\\r\\n**Example:** Contoso sets up RBAC so that only Operations department users have access to their cloud-based inventory management system. Warehouse users do not see this web app on their Entra ID My Apps page.\\r\\n\\r\\nContoso uses Entra ID Conditional Access to control login times, enforcing work hours and enhancing information security. These policies, based on attributes such as time and location, implement Attribute-Based Access Control.\\r\\n\\r\\nContoso also implements a Conditional Access policy that restricts access to the sales ERP system, which contains SPII, to on-premise users only.\\r\\n\\r\\n### Access Management\\r\\n\\r\\nAccess Management enforces the policies and controls implemented, ensuring users have proper access to appropriate resources. Users should also be able to request specific access when needed.\\r\\n\\r\\n**Example:** Contoso has enabled Privileged Identity Management (PIM) on their Entra ID tenant. PIM allows admins to configure eligible roles for specific groups or roles and control the duration and scope of these roles. Users with eligible roles can request access, pending admin approval.\\r\\n\\r\\n### Governance and Compliance\\r\\n\\r\\nGovernance and Compliance involve adhering to regulatory requirements, internal policies, and industry standards. Auditing, reporting, policy management, and risk management fall under this pillar.\\r\\n\\r\\n**Example:** Contoso configured Active Directory/Entra ID to make logs available for further investigation in Entra ID. Admins can view these logs in Microsoft Sentinel or ingest them into a SIEM or SOAR platform. These platforms report on user, group, and application activity, providing threat scoring and enabling security analysts to manage risk. Entra ID also includes Identity Protection and Risk-Based Conditional Access policies for managing user and sign-in risk.\\r\\n\\r\\n### Monitoring and Intelligence\\r\\n\\r\\nMonitoring and Intelligence involve continuously analyzing user activities to detect and respond to anomalies and security threats.\\r\\n\\r\\n**Example:**:As mentioned earlier, Contoso logs are ingested into a SIEM or SOAR platform, where security analysts monitor user, group, and app activities. Microsoft Entra ID Identity Protection assists in detecting, investigating, and remediating risks. Admins can investigate user behavior, mark identities as compromised, and start remediation processes, such as password resets and MFA registration.\\r\\n\\r\\n### Lifecycle Management\\r\\n\\r\\nLifecycle Management covers the entire identity lifecycle, from initial provisioning to de-provisioning and account cleanup. It also includes handling lifecycle events, such as promotions or department transfers, requiring changes in access levels, and ensuring account status matches the user\'s current status in the organization.\\r\\n\\r\\n**Example:** Contoso hires George as a Quality Assurance manager. HR requests a Windows account with appropriate permissions from IT. Entra ID admins create the account with a role matching George\'s title. Upon George\'s promotion, admins update his role, granting access to more enterprise apps, including those with SPII. When George decides to leave after two years, HR informs IT of his departure date. Admins set Entra ID to disable the account on George\'s last workday. His identity is placed in the \\"Deleted Users\\" section, allowing 30 days for possible restoration.\\r\\n\\r\\n## Key Takeaways\\r\\n\\r\\nIn summary, Identity and Access Management (IAM) is crucial for securing organizational resources and implementing least privilege access. By leveraging Entra ID, organizations can effectively manage identity lifecycle, authenticate users, enforce access policies, and ensure compliance. Understanding the pillars of IAM\u2014Identity Management, Authentication, Authorization, Access Management, Governance and Compliance, Monitoring and Intelligence, and Lifecycle Management\u2014enables businesses to build a robust security framework. Implementing these practices helps protect sensitive information, streamline user access, and enhance overall security posture."},{"id":"Site Up and Running","metadata":{"permalink":"/blog/Site Up and Running","source":"@site/blog/2024-05-03-SiteUpandRunnning/index.md","title":"Site Up and Running","description":"Launch post for DarioCruz.dev and what to expect from the blog and portfolio.","date":"2024-05-03T00:00:00.000Z","tags":[{"inline":true,"label":"welcome","permalink":"/blog/tags/welcome"},{"inline":true,"label":"website","permalink":"/blog/tags/website"},{"inline":true,"label":"azure","permalink":"/blog/tags/azure"},{"inline":true,"label":"cicd","permalink":"/blog/tags/cicd"},{"inline":true,"label":"react","permalink":"/blog/tags/react"}],"readingTime":0.5,"hasTruncateMarker":true,"authors":[{"name":"Dario Cruz","title":"Maintainer of DarioCruz.dev","url":"https://github.com/dario-cruz","imageURL":"https://github.com/dario-cruz.png","key":"dcruz","page":null}],"frontMatter":{"slug":"Site Up and Running","title":"Site Up and Running","description":"Launch post for DarioCruz.dev and what to expect from the blog and portfolio.","keywords":["Dario Cruz","blog launch","personal website","portfolio","Docusaurus"],"image":"/img/itsmedario.webp","authors":["dcruz"],"tags":["welcome","website","azure","cicd","react"],"enableComments":true},"unlisted":false,"prevItem":{"title":"Mastering Identity & Access Management","permalink":"/blog/Mastering Identity & Access Management"}},"content":"![dude coding site](dude-coding-site.webp)\\r\\n\\r\\nHello all, \ud83d\udc4b\ud83c\udffd\\r\\n\\r\\nMy name is Dario and I\'ve been working in the IT Support space for 5 years total. 4 years working for Amazon and 1 year working for The Chefs Warehouse.\\r\\n\x3c!-- truncate --\x3e\\r\\nOver the course of my experience I have had some amazing hands on time with some great technologies. Checkout the projects section for more info on projects that I have worked on.\\r\\n\\r\\n# Inception of the Site\\r\\nThis site came about because I needed a place on the internet to share my work and my musings about technology, AI, and software development."}]}}')}}]);